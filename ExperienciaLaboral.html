<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Paint Mobile Pro</title>

<style>
:root{
  --bg:#f2f2f7;
  --panel:#ffffff;
  --accent:#007aff;
  --border:#d1d1d6;
  --shadow:0 10px 30px rgba(0,0,0,.1);
}

*{
  box-sizing:border-box;
  -webkit-tap-highlight-color: transparent;
}

body{
  margin:0;
  background:var(--bg);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  display:flex;
  flex-direction:column;
  height:100vh;
  overflow:hidden;
}

/* =======================
   HEADER
======================= */
header{
  background:var(--panel);
  padding:12px 16px;
  text-align:center;
  font-weight:600;
  box-shadow:var(--shadow);
  z-index:10;
}

/* =======================
   CANVAS AREA
======================= */
.main{
  flex:1;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:10px;
}

.canvas-wrapper{
  background:#fff;
  border-radius:14px;
  box-shadow:var(--shadow);
  overflow:hidden;
  width:100%;
  max-width:1000px;
  height:100%;
}

canvas{
  width:100%;
  height:100%;
  touch-action:none;
  background:white;
}

/* =======================
   TOOLBAR
======================= */
.toolbar{
  background:var(--panel);
  padding:10px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:space-around;
  box-shadow:0 -5px 20px rgba(0,0,0,.1);
}

.tool{
  display:flex;
  flex-direction:column;
  align-items:center;
  font-size:11px;
  cursor:pointer;
}

.tool button,
.tool input{
  width:44px;
  height:44px;
  border-radius:12px;
  border:1px solid var(--border);
  background:white;
  font-size:18px;
}

.tool button.active{
  background:var(--accent);
  color:white;
}

input[type=range]{
  width:80px;
}

/* =======================
   DESKTOP
======================= */
@media(min-width:900px){
  .toolbar{
    justify-content:center;
  }
}
</style>
</head>

<body>

<header>üé® Paint Mobile Pro</header>

<div class="main">
  <div class="canvas-wrapper">
    <canvas id="canvas"></canvas>
  </div>
</div>

<div class="toolbar">
  <div class="tool">
    <button data-tool="pencil" class="active">‚úèÔ∏è</button>
    L√°piz
  </div>
  <div class="tool">
    <button data-tool="marker">üñäÔ∏è</button>
    Marcador
  </div>
  <div class="tool">
    <button data-tool="eraser">üßΩ</button>
    Borrar
  </div>
  <div class="tool">
    <button data-tool="line">üìè</button>
    L√≠nea
  </div>
  <div class="tool">
    <button data-tool="rect">‚¨õ</button>
    Cuadro
  </div>
  <div class="tool">
    <button data-tool="circle">‚ö™</button>
    C√≠rculo
  </div>
  <div class="tool">
    <input type="color" id="color" value="#000000">
    Color
  </div>
  <div class="tool">
    <input type="range" id="size" min="1" max="40" value="5">
    Grosor
  </div>
  <div class="tool">
    <button id="undo">‚Ü©Ô∏è</button>
    Undo
  </div>
  <div class="tool">
    <button id="redo">‚Ü™Ô∏è</button>
    Redo
  </div>
  <div class="tool">
    <button id="clear">üóëÔ∏è</button>
    Limpiar
  </div>
  <div class="tool">
    <button id="save">üíæ</button>
    Guardar
  </div>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let tool = "pencil";
let drawing = false;
let startX = 0;
let startY = 0;
let history = [];
let redoStack = [];

function resizeCanvas(){
  const rect = canvas.parentElement.getBoundingClientRect();
  canvas.width = rect.width;
  canvas.height = rect.height;
  restore();
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

function saveState(){
  history.push(canvas.toDataURL());
  redoStack = [];
}

function restore(){
  if(history.length){
    const img = new Image();
    img.src = history[history.length-1];
    img.onload = ()=>ctx.drawImage(img,0,0);
  }
}

function getPos(e){
  const rect = canvas.getBoundingClientRect();
  const t = e.touches ? e.touches[0] : e;
  return {
    x: t.clientX - rect.left,
    y: t.clientY - rect.top
  };
}

function start(e){
  drawing = true;
  saveState();
  const pos = getPos(e);
  startX = pos.x;
  startY = pos.y;
  ctx.beginPath();
  ctx.moveTo(startX,startY);
}

function move(e){
  if(!drawing) return;
  const pos = getPos(e);
  ctx.lineWidth = size.value;
  ctx.lineCap = "round";
  ctx.strokeStyle = tool==="eraser" ? "#fff" : color.value;

  if(tool==="pencil" || tool==="marker" || tool==="eraser"){
    ctx.lineTo(pos.x,pos.y);
    ctx.stroke();
  }
}

function end(e){
  if(!drawing) return;
  drawing = false;
  const pos = getPos(e);
  ctx.closePath();

  ctx.strokeStyle = color.value;
  ctx.lineWidth = size.value;

  if(tool==="line"){
    ctx.beginPath();
    ctx.moveTo(startX,startY);
    ctx.lineTo(pos.x,pos.y);
    ctx.stroke();
  }

  if(tool==="rect"){
    ctx.strokeRect(startX,startY,pos.x-startX,pos.y-startY);
  }

  if(tool==="circle"){
    ctx.beginPath();
    const r = Math.hypot(pos.x-startX,pos.y-startY);
    ctx.arc(startX,startY,r,0,Math.PI*2);
    ctx.stroke();
  }
}

canvas.addEventListener("mousedown",start);
canvas.addEventListener("mousemove",move);
canvas.addEventListener("mouseup",end);
canvas.addEventListener("touchstart",start);
canvas.addEventListener("touchmove",move);
canvas.addEventListener("touchend",end);

document.querySelectorAll("[data-tool]").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll("[data-tool]").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    tool = btn.dataset.tool;
  }
});

undo.onclick=()=>{
  if(history.length>1){
    redoStack.push(history.pop());
    ctx.clearRect(0,0,canvas.width,canvas.height);
    restore();
  }
};

redo.onclick=()=>{
  if(redoStack.length){
    history.push(redoStack.pop());
    restore();
  }
};

clear.onclick=()=>{
  saveState();
  ctx.clearRect(0,0,canvas.width,canvas.height);
};

save.onclick=()=>{
  const a=document.createElement("a");
  a.href=canvas.toDataURL("image/png");
  a.download="dibujo.png";
  a.click();
};

saveState();
</script>

</body>
</html>