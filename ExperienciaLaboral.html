<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sterl-ink sketching</title>
<link rel='stylesheet' href='https://cdn-uicons.flaticon.com/3.0.0/uicons-solid-rounded/css/uicons-solid-rounded.css'>
<link rel='stylesheet' href='https://cdn-uicons.flaticon.com/3.0.0/uicons-bold-rounded/css/uicons-bold-rounded.css'>
<link rel='stylesheet' href='https://cdn-uicons.flaticon.com/3.0.0/uicons-solid-straight/css/uicons-solid-straight.css'>
<link rel='stylesheet' href='https://cdn-uicons.flaticon.com/3.0.0/uicons-solid-straight/css/uicons-solid-straight.css'>
<script src="https://cdn.tailwindcss.com"></script>

<style>
/* ===============================
   VARIABLES SISTEMA
================================ */
:root{
  --bg:#f2f2f7;
  --panel:#ffffffcc;
  --border:#C4C4C4;
  --accent:#0a84ff;
  --text:#111;
  --shadow:0 10px 20px rgba(0,0,0,.18);
}

@media(prefers-color-scheme:dark){
  :root{
    --bg:#0d0d0f;
    --panel:#1c1c1ecc;
    --border:#2c2c2e;
    --text:#f5f5f7;
  }
}

*{
  box-sizing:border-box;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}

body{
  margin:0;
  height:100vh;
  overflow:hidden;
  background:var(--bg);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI";
}

/* ===============================
   CANVAS
================================ */
#viewport{
  position:absolute;
  inset:0;
  overflow:hidden;
}

#canvas{
  position:absolute;
  top:0;
  left:0;
  background:#fff;
  touch-action:none;
}

/* ===============================
   FLOATING PANELS
================================ */
.panel{
  position:fixed;
  background:var(--panel);
  backdrop-filter:blur(10px);
  border:1px solid var(--border);
  border-radius:60px;
  padding:4px;
}

.panel2{
  position:fixed;
  background:var(--panel);
  backdrop-filter:blur(30px);
  border:1px solid var(--border);
  border-radius:18px;
  padding:14px;
  box-shadow:var(--shadow);
}


/* TOOLBAR */
#tools{
  left:50%;
  bottom:14px;
  top:auto;
  transform: translateX(-50%) translateY(30%);
  display:flex;
  flex-direction:row;
  gap:6px;
  padding:6px 10px;
  
  opacity: 0.15;
  transition: transform 0.35s ease, opacity 0.35s ease;
}

#tools:hover{
  transform: translateX(-50%) translateY(0);
  opacity: 1;
}

.tool{
  width:48px;
  height:48px;
  border-radius:60px;
  background:#ffffff;
  font-size:22px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}

.tool:hover {
  border: 1px solid var(--border);
  background: #C4C4C4;
}

.tool.active{
  background:var(--accent);
  color:white;
}

/* OPTIONS */
#options{
  right:14px;
  top:20px;
  width:220px;
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* LAYERS */
#layers{
  right:14px;
  bottom:20px;
  width:220px;
}

.layer{
  padding:8px;
  border:1px solid var(--border);
  border-radius:10px;
  margin-bottom:6px;
  background:white;
  cursor:pointer;
}

.layer.active{
  border-color:var(--accent);
}

/* SLIDERS */
input[type=range]{
  width:100%;
}

/* ===============================
   DESKTOP
================================ */
@media(max-width:900px){
  #options,#layers{
    width:180px;
  }
}

/* --------------------- CODIGO DE BOTON DE EXPORTAR EN PNG ----------------------------*/
.win11-btn {
  appearance: none;
  border: none;
  border-radius: 999px;
  padding: 3px 20px;
  font-size: 15px;
  font-weight: 600;
  font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  color: #ffffff;
  background: linear-gradient(
    135deg,
    rgba(0, 120, 212, 0.95),
    rgba(0, 90, 180, 0.95)
  );
  cursor: pointer;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  transition:
    transform 0.18s ease,
    box-shadow 0.18s ease,
    background 0.18s ease;
}

/* Hover */
.win11-btn:hover {
  background: linear-gradient(
    135deg,
    rgb(255, 255, 255),
    rgb(238, 238, 238)
  );
  transform: translateY(-1px);
  color: #0d0d0f;
}

/* Active */
.win11-btn:active {
  transform: translateY(1px) scale(0.98);
  box-shadow:
    0 5px 14px rgba(0, 120, 212, 0.3),
    inset 0 2px 6px rgba(0, 0, 0, 0.25);
}

/* Focus (accesibilidad Windows 11) */
.win11-btn:focus-visible {
  outline: none;
  box-shadow:
    0 0 0 3px rgba(0, 120, 212, 0.45),
    0 8px 20px rgba(0, 120, 212, 0.35);
}


/* Bubble */
.menu-bubble {
  position: fixed;
  bottom: 24px;
  right: 24px;
  width: 64px;
  height: 64px;
  background: linear-gradient(135deg, #0078d4, #00a2ff);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 12px 30px rgba(0,0,0,.25);
  z-index: 1000;
}

.menu-label {
  color: #fff;
  font-size: 14px;
  font-weight: 600;
}

/* Panel */
.panel2 {
  position: fixed;
  bottom: 100px;
  right: 24px;
  width: 260px;
  padding: 16px;
  background: rgba(255,255,255,.95);
  backdrop-filter: blur(12px);
  border-radius: 14px;
  box-shadow: 0 20px 50px rgba(0,0,0,.25);
  opacity: 0;
  transform: translateY(20px) scale(.95);
  pointer-events: none;
  transition: all .35s ease;
  z-index: 999;
}

.panel2.active {
  opacity: 1;
  transform: translateY(0) scale(1);
  pointer-events: auto;
}

/* Header */
.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
  font-weight: 600;
}

/* Close button */
.close-btn {
  background: none;
  border: none;
  font-size: 18px;
  cursor: pointer;
  line-height: 1;
  padding: 4px;
  border-radius: 6px;
}

.close-btn:hover {
  background: rgba(0,0,0,.08);
}


</style>
</head>

<body>

<div id="viewport">
  <canvas id="canvas"></canvas>
</div>

<!-- TOOLS -->
<div class="panel" id="tools">
  <div class="tool active" data-tool="pen" name="Lápiz"><i class="fi fi-sr-attribution-pencil"></i></div>
  <div class="tool" data-tool="brush" name="Pincel"><i class="fi fi-ss-makeup-brush"></i></div>
  <div class="tool" data-tool="marker" name="Marcador"><i class="fi fi-sr-pen-fancy"></i></i></div>
  <div class="tool" data-tool="eraser" name="Borrador"><i class="fi fi-sr-eraser"></i></i></div>
  <div class="tool" data-tool="line" name="Línea"><i class="fi fi-br-slash"></i></i></div>
  <div class="tool" data-tool="rect" name="Cuadro"><i class="fi fi-br-frame"></i></div>
  <div class="tool" data-tool="circle" name="Circulo"><i class="fi fi-br-circle-dashed"></i></div>
  <div class="tool" id="undo" name="Retroceder"><i class="fi fi-br-undo-alt"></i></div>
  <div class="tool" id="redo" name="Rehacer"><i class="fi fi-br-redo-alt"></i></div>
</div>

<!-- MENU BUBBLE -->
<div class="menu-bubble" id="menuBubble">
  <span class="menu-label">Menú</span>
</div>

<!-- OPTIONS PANEL -->
<div class="panel2" id="options">
  <div class="panel-header">
    <span>Configuración</span>
    <button class="close-btn" id="closeMenu">✕</button>
  </div>

  <p>Selecciona las opciones que mejorarán tu proyecto.</p>
  <br>
  <hr>

  <label>
    Color:<br>
    <input type="color" id="color" value="#000000">
  </label>

  <hr>

  <label>
    Tamaño del pincel:
    <input type="range" id="size" min="1" max="40" value="6">
  </label>
  <hr>
  <button id="save" class="win11-btn">Exportar PNG</button>
</div>


<script>
/* ===============================
   ENGINE
================================ */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
let dpr = window.devicePixelRatio || 1;

function resize(){
  canvas.width = innerWidth * dpr;
  canvas.height = innerHeight * dpr;
  canvas.style.width = innerWidth+"px";
  canvas.style.height = innerHeight+"px";
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
resize();
addEventListener("resize",resize);

/* ===============================
   STATE
================================ */
let tool="pen";
let drawing=false;
let startX,startY;
let history=[],redoStack=[];
let layers=[{id:Date.now(),img:null}];
let activeLayer=0;

/* ===============================
   HISTORY
================================ */
function snapshot(){
  history.push(canvas.toDataURL());
  redoStack=[];
}

/* ===============================
   INPUT
================================ */
function pos(e){
  const r=canvas.getBoundingClientRect();
  const t=e.touches?e.touches[0]:e;
  return {x:t.clientX-r.left,y:t.clientY-r.top};
}

canvas.addEventListener("pointerdown",e=>{
  snapshot();
  drawing=true;
  const p=pos(e);
  startX=p.x; startY=p.y;
  ctx.beginPath();
  ctx.moveTo(p.x,p.y);
});

canvas.addEventListener("pointermove",e=>{
  if(!drawing) return;
  const p=pos(e);
  ctx.strokeStyle=tool==="eraser"?"#fff":color.value;
  ctx.lineWidth=size.value;
  ctx.lineCap="round";

  if(["pen","brush","marker","eraser"].includes(tool)){
    ctx.lineTo(p.x,p.y);
    ctx.stroke();
  }
});

canvas.addEventListener("pointerup",e=>{
  if(!drawing) return;
  drawing=false;
  const p=pos(e);
  ctx.closePath();

  if(tool==="line"){
    ctx.beginPath();
    ctx.moveTo(startX,startY);
    ctx.lineTo(p.x,p.y);
    ctx.stroke();
  }
  if(tool==="rect"){
    ctx.strokeRect(startX,startY,p.x-startX,p.y-startY);
  }
  if(tool==="circle"){
    ctx.beginPath();
    ctx.arc(startX,startY,Math.hypot(p.x-startX,p.y-startY),0,Math.PI*2);
    ctx.stroke();
  }
});

/* ===============================
   UI
================================ */
document.querySelectorAll(".tool[data-tool]").forEach(t=>{
  t.onclick=()=>{
    document.querySelectorAll(".tool").forEach(b=>b.classList.remove("active"));
    t.classList.add("active");
    tool=t.dataset.tool;
  };
});

undo.onclick=()=>{
  if(history.length){
    redoStack.push(history.pop());
    const img=new Image();
    img.src=history.at(-1);
    img.onload=()=>ctx.drawImage(img,0,0);
  }
};

redo.onclick=()=>{
  if(redoStack.length){
    const img=new Image();
    img.src=redoStack.pop();
    img.onload=()=>ctx.drawImage(img,0,0);
  }
};

save.onclick=()=>{
  const a=document.createElement("a");
  a.href=canvas.toDataURL("image/png");
  a.download="paint-pro.png";
  a.click();
};

// BUBBLE
const bubble   = document.getElementById('menuBubble');
const panel    = document.getElementById('options');
const closeBtn = document.getElementById('closeMenu');

/* Abrir / cerrar desde la burbuja */
bubble.addEventListener('click', (e) => {
  e.stopPropagation();
  panel.classList.toggle('active');
});

/* Cerrar con botón interno */
closeBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  panel.classList.remove('active');
});

/* Evita que clicks dentro del panel lo cierren */
panel.addEventListener('click', (e) => {
  e.stopPropagation();
});

/* Click fuera del panel → cerrar */
document.addEventListener('click', () => {
  panel.classList.remove('active');
});
</script>

</body>
</html>
