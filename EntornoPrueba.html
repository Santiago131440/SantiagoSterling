<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Santiago Sterling</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,300;0,400;0,700;1,300;1,400&family=DM+Sans:wght@200;300;400;500&family=Cormorant+Garamond:ital,wght@0,300;1,300&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,300;0,400;0,700;1,300;1,400&family=DM+Sans:wght@200;300;400;500&family=Cormorant+Garamond:ital,wght@0,300;1,300&display=swap');

    :root {
      --white: #f0ede8;
      --black: #030303;
      --gray: #6e6e73;
      --light-gray: #c8c3b8;
      --accent: #c8a96e;
      --accent2: #7b9e87;
      --accent3: #8b6b8a;
    }

    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: auto; }

    body {
      background: #030303;
      color: var(--white);
      font-family:'Inter', system-ui, sans-serif;
      overflow-x: hidden;
      cursor: none;
      -webkit-font-smoothing: antialiased;
    }

    /* ── Cursor ── */
    #cursor {
      position: fixed; width: 8px; height: 8px;
      background: var(--accent); border-radius: 50%;
      pointer-events: none; z-index: 9999;
      transform: translate(-50%, -50%);
      transition: width .2s, height .2s;
      mix-blend-mode: normal;
    }
    #cursor-ring {
      position: fixed; width: 38px; height: 38px;
      border: 1px solid rgba(200,169,110,0.4);
      border-radius: 50%; pointer-events: none; z-index: 9998;
      transform: translate(-50%, -50%);
      transition: width .25s, height .25s, border-color .25s;
    }
    body.cursor-hover #cursor { width: 18px; height: 18px; background: var(--accent); }
    body.cursor-hover #cursor-ring { width: 64px; height: 64px; border-color: rgba(200,169,110,0.5); }

    /* ── Progress ── */
    #progress-bar {
      position: fixed; top: 0; left: 0; height: 1px;
      background: linear-gradient(90deg, var(--accent), var(--accent2), var(--accent3));
      z-index: 2000; width: 0%;
      transition: width .06s linear;
    }

    /* ── Nav ── */
    nav {
      position: fixed; top: 0; left: 0; right: 0;
      z-index: 1000; padding: 22px 52px;
      display: flex; justify-content: space-between; align-items: center;
    }
    nav::before {
      content: ''; position: absolute; inset: 0;
      background: linear-gradient(to bottom, rgba(3,3,3,0.6), transparent);
      pointer-events: none;
    }
    .nav-logo {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-weight: 300; font-style: italic; font-size: 24px;
      letter-spacing: .06em; color: var(--white); position: relative;
    }
    .nav-links {
      display: flex; gap: 40px; list-style: none; position: relative;
    }
    .nav-links a {
      color: rgba(240,237,232,0.55); text-decoration: none;
      font-size: 12px; font-weight: 300; letter-spacing: .12em;
      text-transform: uppercase; transition: color .3s;
    }
    .nav-links a:hover { color: var(--accent); }

    /* ── Chapter Dots ── */
    #chapter-dots {
      position: fixed; right: 30px; top: 50%; transform: translateY(-50%);
      z-index: 500; display: flex; flex-direction: column; gap: 12px;
    }
    .ch-dot {
      width: 5px; height: 5px; border-radius: 50%;
      background: rgba(240,237,232,0.2);
      transition: background .3s, transform .3s, height .3s;
      cursor: pointer;
    }
    .ch-dot.active {
      background: var(--accent); transform: scale(1.6);
    }
    .ch-dot:hover { background: rgba(200,169,110,0.6); }

    /* ══════════════════════════════════════
       SCENE 1 — Video Story (8 layers)
    ══════════════════════════════════════ */
    #scene-1 {
      position: relative;
      height: 950vh;
    }
    #sticky-1 {
      position: sticky; top: 0; width: 100%; height: 100vh; overflow: hidden;
    }
    #bg-video {
      position: absolute; inset: 0; width: 100%; height: 100%;
      object-fit: cover; opacity: 0.75;
    }
    canvas#fallback-canvas {
      position: absolute; inset: 0; width: 100%; height: 100%; display: none;
    }

    /* ══════════════════════════════════════
       SCENE 2 — Color Wash (6 layers)
    ══════════════════════════════════════ */
    #scene-2 {
      position: relative;
      height: 750vh;
    }
    #sticky-2 {
      position: sticky; top: 0; width: 100%; height: 100vh; overflow: hidden;
    }
    #color-bg {
      position: absolute; inset: 0;
      background: #030303;
      transition: background 0.1s;
    }
    .color-orb {
      position: absolute; border-radius: 50%;
      filter: blur(120px); opacity: 0; pointer-events: none;
      transition: opacity .3s;
    }
    #orb-a { width: 80vw; height: 80vh; top: -20%; left: -20%; background: radial-gradient(circle, #1a3a2a 0%, transparent 70%); }
    #orb-b { width: 70vw; height: 70vh; top: 10%; right: -10%; background: radial-gradient(circle, #2a1a3a 0%, transparent 70%); }
    #orb-c { width: 90vw; height: 60vh; bottom: -10%; left: 5%; background: radial-gradient(circle, #3a2a1a 0%, transparent 70%); }
    #orb-d { width: 60vw; height: 80vh; top: 20%; left: 20%; background: radial-gradient(circle, #1a2a3a 0%, transparent 70%); }

    /* ══════════════════════════════════════
       SCENE 3 — Grid / Mosaic (5 layers)
    ══════════════════════════════════════ */
    #scene-3 {
      position: relative;
      height: 650vh;
    }
    #sticky-3 {
      position: sticky; top: 0; width: 100%; height: 100vh; overflow: hidden;
      display: grid; grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(4, 1fr);
    }
    .mosaic-cell {
      overflow: hidden; position: relative;
      transition: opacity .6s, transform .6s;
    }
    .mosaic-cell img {
      width: 100%; height: 100%; object-fit: cover; display: block;
      filter: grayscale(1) brightness(0.4);
      transition: filter .8s, transform .8s;
    }
    .mosaic-cell.lit img { filter: grayscale(0) brightness(0.85); transform: scale(1.04); }

    /* ── Shared fades & overlays ── */
    .vignette {
      position: absolute; inset: 0;
      background: radial-gradient(ellipse at center, transparent 30%, rgba(3,3,3,0.7) 100%);
      pointer-events: none; z-index: 2;
    }
    .bottom-fade {
      position: absolute; bottom: 0; left: 0; right: 0; height: 40vh;
      background: linear-gradient(to bottom, transparent, #030303);
      pointer-events: none; z-index: 2;
    }
    .top-fade {
      position: absolute; top: 0; left: 0; right: 0; height: 15vh;
      background: linear-gradient(to top, transparent, #030303);
      pointer-events: none; z-index: 2;
    }

    /* ── Story Layers (shared) ── */
    .story-layer {
      position: absolute; inset: 0; z-index: 10;
      display: flex; align-items: center; justify-content: center;
      flex-direction: column; text-align: center; padding: 0 24px;
      opacity: 0; transform: translateY(32px); pointer-events: none;
    }
    .story-layer.active { pointer-events: auto; }

    .story-layer .eyebrow {
      font-size: 10px; font-weight: 400;
      letter-spacing: .22em; text-transform: uppercase;
      color: var(--accent); margin-bottom: 22px;
      opacity: 0.9;
    }
    .story-layer h1 {
      font-family: 'Playfair Display', Georgia, serif;
      font-weight: 300; font-size: clamp(44px, 8vw, 100px);
      line-height: 1.04; color: var(--white);
      max-width: 980px; letter-spacing: -.01em;
    }
    .story-layer h1 em {
      font-style: italic; color: var(--accent);
    }
    .story-layer h1 strong {
      font-weight: 700; color: #fff;
    }
    .story-layer p {
      margin-top: 30px; font-size: clamp(14px, 1.6vw, 18px);
      font-weight: 300; color: rgba(240,237,232,0.55);
      max-width: 580px; line-height: 1.75; letter-spacing: .02em;
    }

    /* Stat row */
    .stat-row {
      display: flex; gap: 32px; margin-top: 48px;
      flex-wrap: wrap; justify-content: center;
    }
    .stat {
      text-align: center;
      border: 1px solid rgba(200,169,110,0.15);
      border-radius: 14px; padding: 24px 32px;
      backdrop-filter: blur(14px);
      background: rgba(200,169,110,0.05);
      min-width: 120px;
    }
    .stat-num {
      font-family: 'Cormorant Garamond', serif;
      font-size: 46px; font-weight: 300; color: var(--accent); line-height: 1;
    }
    .stat-label {
      font-size: 10px; font-weight: 400; letter-spacing: .15em;
      text-transform: uppercase; color: var(--gray); margin-top: 8px;
    }

    /* CTA pill */
    .story-layer .cta {
      margin-top: 48px;
      display: inline-flex; align-items: center; gap: 12px;
      font-size: 13px; font-weight: 400; letter-spacing: .08em;
      text-transform: uppercase; color: var(--accent);
      border: 1px solid rgba(200,169,110,0.35);
      padding: 14px 36px; border-radius: 980px;
      backdrop-filter: blur(10px);
      background: rgba(200,169,110,0.07);
      cursor: pointer; pointer-events: auto;
      transition: background .3s, border-color .3s, gap .3s;
    }
    .story-layer .cta:hover {
      background: rgba(200,169,110,0.14);
      border-color: var(--accent); gap: 18px;
    }

    /* Quote style */
    .story-layer blockquote {
      margin-top: 36px;
      font-family: 'Cormorant Garamond', serif;
      font-style: italic; font-size: clamp(18px, 2.5vw, 28px);
      font-weight: 300; color: rgba(200,169,110,0.7);
      max-width: 640px; line-height: 1.6;
      border-left: 2px solid rgba(200,169,110,0.3);
      padding-left: 28px; text-align: left;
    }

    /* Tag chips */
    .tag-row {
      display: flex; flex-wrap: wrap; gap: 10px;
      margin-top: 36px; justify-content: center;
    }
    .tag {
      font-size: 11px; font-weight: 400; letter-spacing: .1em;
      text-transform: uppercase; padding: 7px 18px;
      border: 1px solid rgba(240,237,232,0.12); border-radius: 980px;
      color: rgba(240,237,232,0.5);
      background: rgba(240,237,232,0.04);
    }

    /* ── Scroll hint ── */
    #scroll-hint {
      position: fixed; bottom: 34px; left: 50%;
      transform: translateX(-50%); z-index: 200;
      display: flex; flex-direction: column; align-items: center; gap: 8px;
      opacity: 1; transition: opacity .5s;
    }
    #scroll-hint span {
      font-size: 9px; letter-spacing: .16em;
      text-transform: uppercase; color: rgba(240,237,232,0.35);
    }
    #scroll-hint .mouse {
      width: 20px; height: 32px;
      border: 1px solid rgba(200,169,110,0.3); border-radius: 10px; position: relative;
    }
    #scroll-hint .mouse::before {
      content: ''; position: absolute; width: 2px; height: 6px;
      background: rgba(200,169,110,0.7); border-radius: 2px;
      left: 50%; top: 6px; transform: translateX(-50%);
      animation: scrollDot 1.8s ease-in-out infinite;
    }
    @keyframes scrollDot {
      0%   { opacity: 1; transform: translateX(-50%) translateY(0); }
      60%  { opacity: 0; transform: translateX(-50%) translateY(9px); }
      100% { opacity: 0; transform: translateX(-50%) translateY(0); }
    }

    /* ══════════════════════════════════════
       POST-SCROLL SECTIONS
    ══════════════════════════════════════ */
    .post-scroll {
      background: #030303; position: relative; z-index: 60;
    }

    /* ── Section: Manifiesto ── */
    .section-manifesto {
      padding: 160px 52px 120px;
      max-width: 1200px; margin: 0 auto;
      display: grid; grid-template-columns: 1fr 1fr; gap: 100px; align-items: start;
    }
    .section-manifesto .left .s-eyebrow {
      font-size: 10px; letter-spacing: .2em; text-transform: uppercase;
      color: var(--accent); margin-bottom: 28px;
    }
    .section-manifesto .left h2 {
      font-family: 'Playfair Display', serif; font-weight: 300;
      font-size: clamp(36px, 4.5vw, 60px); line-height: 1.1; color: var(--white);
    }
    .section-manifesto .left h2 em { font-style: italic; color: var(--accent); }
    .section-manifesto .right p {
      font-size: 16px; font-weight: 300; color: rgba(240,237,232,0.5);
      line-height: 1.85; margin-bottom: 24px;
    }
    .section-manifesto .right .divider {
      width: 40px; height: 1px; background: var(--accent); opacity: 0.4;
      margin: 32px 0;
    }
    .section-manifesto .right .signature {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic; font-size: 20px; font-weight: 300;
      color: var(--accent); opacity: 0.7;
    }

    /* ── Section: Feature Grid ── */
    .section-features {
      padding: 80px 52px 140px;
      max-width: 1200px; margin: 0 auto;
    }
    .section-features .s-header {
      display: flex; justify-content: space-between; align-items: flex-end;
      margin-bottom: 64px; flex-wrap: wrap; gap: 20px;
    }
    .section-features .s-eyebrow {
      font-size: 10px; letter-spacing: .2em;
      text-transform: uppercase; color: var(--accent); margin-bottom: 16px;
    }
    .section-features h2 {
      font-family: 'Playfair Display', serif; font-weight: 300;
      font-size: clamp(32px, 4vw, 54px); line-height: 1.1; color: var(--white);
    }
    .section-features h2 em { font-style: italic; color: var(--light-gray); }
    .section-features .s-subtext {
      font-size: 13px; font-weight: 300; color: rgba(240,237,232,0.4);
      max-width: 280px; line-height: 1.7; text-align: right;
    }
    .feature-grid-new {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: auto auto;
      gap: 1px;
      border: 1px solid rgba(240,237,232,0.07);
      border-radius: 20px; overflow: hidden;
    }
    .fg-card {
      padding: 44px 40px;
      background: rgba(240,237,232,0.025);
      border-right: 1px solid rgba(240,237,232,0.07);
      border-bottom: 1px solid rgba(240,237,232,0.07);
      transition: background .4s;
      position: relative; overflow: hidden;
    }
    .fg-card::before {
      content: ''; position: absolute; inset: 0;
      background: linear-gradient(135deg, rgba(200,169,110,0.04), transparent);
      opacity: 0; transition: opacity .4s;
    }
    .fg-card:hover { background: rgba(240,237,232,0.05); }
    .fg-card:hover::before { opacity: 1; }
    .fg-card.wide { grid-column: span 2; }
    .fg-num {
      font-family: 'Cormorant Garamond', serif;
      font-size: 56px; font-weight: 300; color: rgba(200,169,110,0.15);
      line-height: 1; margin-bottom: 20px;
    }
    .fg-card h3 {
      font-family: 'Playfair Display', serif;
      font-weight: 400; font-size: 20px; color: var(--white); margin-bottom: 14px;
    }
    .fg-card p {
      font-size: 13px; font-weight: 300; color: rgba(240,237,232,0.45);
      line-height: 1.75;
    }
    .fg-card .fg-tag {
      display: inline-block; margin-top: 20px;
      font-size: 10px; font-weight: 400; letter-spacing: .12em;
      text-transform: uppercase; color: var(--accent);
      border: 1px solid rgba(200,169,110,0.25); padding: 5px 14px; border-radius: 980px;
    }

    /* ── Section: Timeline ── */
    .section-timeline {
      padding: 120px 52px 140px;
      max-width: 1000px; margin: 0 auto;
      border-top: 1px solid rgba(240,237,232,0.06);
    }
    .section-timeline .s-eyebrow {
      font-size: 10px; letter-spacing: .2em; text-transform: uppercase;
      color: var(--accent2); margin-bottom: 28px;
    }
    .section-timeline h2 {
      font-family: 'Playfair Display', serif; font-weight: 300;
      font-size: clamp(30px, 4vw, 52px); line-height: 1.1;
      color: var(--white); margin-bottom: 70px;
    }
    .section-timeline h2 em { font-style: italic; color: var(--accent2); }
    .timeline-item {
      display: grid; grid-template-columns: 100px 1fr;
      gap: 40px; padding: 40px 0;
      border-top: 1px solid rgba(240,237,232,0.06);
      position: relative;
    }
    .timeline-item::before {
      content: ''; position: absolute; left: 92px;
      top: 0; bottom: 0; width: 1px;
      background: rgba(240,237,232,0.06);
    }
    .timeline-year {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic; font-size: 32px; font-weight: 300;
      color: rgba(200,169,110,0.45); padding-top: 4px;
    }
    .timeline-content h4 {
      font-family: 'Playfair Display', serif;
      font-weight: 400; font-size: 20px; color: var(--white); margin-bottom: 10px;
    }
    .timeline-content p {
      font-size: 14px; font-weight: 300; color: rgba(240,237,232,0.45); line-height: 1.75;
    }
    .timeline-content .tl-badge {
      display: inline-block; margin-top: 14px;
      font-size: 10px; font-weight: 400; letter-spacing: .1em;
      text-transform: uppercase; color: var(--accent2);
      border: 1px solid rgba(123,158,135,0.25); padding: 4px 12px; border-radius: 980px;
    }

    /* ── Section: Testimonials ── */
    .section-testimonials {
      padding: 100px 52px 140px;
      background: rgba(200,169,110,0.03);
      border-top: 1px solid rgba(200,169,110,0.08);
      border-bottom: 1px solid rgba(200,169,110,0.08);
    }
    .section-testimonials .inner {
      max-width: 1200px; margin: 0 auto;
    }
    .section-testimonials .s-eyebrow {
      font-size: 10px; letter-spacing: .2em; text-transform: uppercase;
      color: var(--accent3); margin-bottom: 60px; text-align: center;
    }
    .testimonials-grid {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 28px;
    }
    .test-card {
      padding: 36px 32px;
      border: 1px solid rgba(240,237,232,0.07); border-radius: 16px;
      background: rgba(240,237,232,0.025);
      transition: border-color .3s, background .3s;
    }
    .test-card:hover {
      border-color: rgba(200,169,110,0.2); background: rgba(240,237,232,0.05);
    }
    .test-quote {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic; font-size: 18px; font-weight: 300;
      color: rgba(240,237,232,0.7); line-height: 1.7; margin-bottom: 28px;
    }
    .test-author {
      display: flex; align-items: center; gap: 14px;
    }
    .test-avatar {
      width: 38px; height: 38px; border-radius: 50%;
      border: 1px solid rgba(200,169,110,0.2);
      background: linear-gradient(135deg, rgba(200,169,110,0.15), rgba(123,158,135,0.15));
      display: flex; align-items: center; justify-content: center;
      font-family: 'Cormorant Garamond', serif;
      font-size: 14px; color: var(--accent); font-style: italic;
    }
    .test-name {
      font-size: 13px; font-weight: 400; color: var(--white);
    }
    .test-role {
      font-size: 11px; font-weight: 300; color: var(--gray); letter-spacing: .05em;
    }

    /* ── Section: Numbers ── */
    .section-numbers {
      padding: 140px 52px;
      max-width: 1200px; margin: 0 auto;
    }
    .numbers-row {
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 1px;
      border: 1px solid rgba(240,237,232,0.07);
      border-radius: 16px; overflow: hidden;
    }
    .num-cell {
      padding: 52px 36px; background: rgba(240,237,232,0.02);
      border-right: 1px solid rgba(240,237,232,0.07);
      transition: background .3s;
    }
    .num-cell:hover { background: rgba(240,237,232,0.05); }
    .num-value {
      font-family: 'Cormorant Garamond', serif;
      font-size: 64px; font-weight: 300; color: var(--accent);
      line-height: 1; margin-bottom: 12px;
    }
    .num-label {
      font-size: 11px; font-weight: 300; letter-spacing: .12em;
      text-transform: uppercase; color: rgba(240,237,232,0.4);
    }
    .num-desc {
      margin-top: 14px; font-size: 13px; font-weight: 300;
      color: rgba(240,237,232,0.3); line-height: 1.6;
    }

    /* ── Section: CTA Final ── */
    .section-cta-final {
      padding: 120px 52px 160px;
      text-align: center;
      border-top: 1px solid rgba(240,237,232,0.06);
    }
    .section-cta-final .s-eyebrow {
      font-size: 10px; letter-spacing: .2em; text-transform: uppercase;
      color: var(--accent); margin-bottom: 32px;
    }
    .section-cta-final h2 {
      font-family: 'Playfair Display', serif; font-weight: 300;
      font-size: clamp(40px, 6vw, 80px); line-height: 1.08; color: var(--white);
      margin-bottom: 28px;
    }
    .section-cta-final h2 em { font-style: italic; color: var(--accent); }
    .section-cta-final p {
      font-size: 16px; font-weight: 300; color: rgba(240,237,232,0.45);
      max-width: 520px; margin: 0 auto 52px; line-height: 1.75;
    }
    .btn-primary {
      display: inline-flex; align-items: center; gap: 14px;
      font-size: 13px; font-weight: 400; letter-spacing: .1em;
      text-transform: uppercase; color: #030303;
      background: var(--accent); padding: 16px 44px; border-radius: 980px;
      cursor: pointer; text-decoration: none;
      transition: transform .3s, box-shadow .3s;
      box-shadow: 0 0 40px rgba(200,169,110,0.25);
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 60px rgba(200,169,110,0.35);
    }
    .btn-ghost {
      display: inline-flex; align-items: center; gap: 12px;
      font-size: 13px; font-weight: 400; letter-spacing: .1em;
      text-transform: uppercase; color: rgba(240,237,232,0.6);
      border: 1px solid rgba(240,237,232,0.15); padding: 16px 44px;
      border-radius: 980px; cursor: pointer; text-decoration: none;
      margin-left: 16px;
      transition: color .3s, border-color .3s;
    }
    .btn-ghost:hover { color: var(--white); border-color: rgba(240,237,232,0.35); }

    /* ── Footer ── */
    footer {
      border-top: 1px solid rgba(240,237,232,0.06);
      padding: 60px 52px;
      max-width: 1200px; margin: 0 auto;
      display: flex; justify-content: space-between;
      align-items: center; flex-wrap: wrap; gap: 24px;
    }
    footer .f-logo {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic; font-weight: 300; font-size: 22px;
      color: rgba(240,237,232,0.4);
    }
    footer p { font-size: 11px; color: rgba(240,237,232,0.2); letter-spacing: .06em; }
    footer nav.f-nav {
      display: flex; gap: 28px; position: static; padding: 0;
    }
    footer nav.f-nav::before { display: none; }
    footer nav.f-nav a {
      font-size: 11px; font-weight: 300; letter-spacing: .1em;
      text-transform: uppercase; color: rgba(240,237,232,0.3);
      text-decoration: none; transition: color .3s;
    }
    footer nav.f-nav a:hover { color: var(--accent); }

    /* ══════════════════════════════════════
       LOADER
    ══════════════════════════════════════ */
    #loader {
      position: fixed; inset: 0; z-index: 99999;
      background: #030303;
      display: flex; align-items: center; justify-content: center;
      transition: opacity .8s ease, visibility .8s ease;
    }
    #loader.hidden {
      opacity: 0; visibility: hidden; pointer-events: none;
    }
    #loader-inner {
      display: flex; flex-direction: column;
      align-items: center; gap: 20px;
      text-align: center;
    }
    #loader-logo {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic; font-weight: 300;
      font-size: 36px; letter-spacing: .08em;
      color: var(--accent);
      opacity: 0;
      animation: loaderFadeIn .6s ease .2s forwards;
    }
    #loader-bar-wrap {
      width: 200px; height: 1px;
      background: rgba(200,169,110,0.15);
      border-radius: 1px; overflow: hidden;
      opacity: 0;
      animation: loaderFadeIn .6s ease .4s forwards;
    }
    #loader-bar {
      height: 100%; width: 0%;
      background: linear-gradient(90deg, var(--accent), rgba(200,169,110,0.5));
      transition: width .15s ease;
    }
    #loader-pct {
      font-family: 'Cormorant Garamond', serif;
      font-size: 48px; font-weight: 300; color: rgba(200,169,110,0.9);
      letter-spacing: -.02em; line-height: 1;
      opacity: 0; animation: loaderFadeIn .6s ease .4s forwards;
    }
    #loader-label {
      font-size: 10px; font-weight: 300; letter-spacing: .2em;
      text-transform: uppercase; color: rgba(240,237,232,0.3);
      opacity: 0; animation: loaderFadeIn .6s ease .6s forwards;
    }
    @keyframes loaderFadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* ── Main canvas (frame scrubbing) ── */
    #main-canvas {
      position: absolute; inset: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      opacity: 0.82;
    }

    /* Bloquear scroll hasta que cargue */
    body.loading {
      overflow: hidden;
    }

    /* ── Scroll velocity indicator ── */
    #scroll-velocity {
      position: absolute;
      bottom: 52px;
      right: 52px;
      z-index: 20;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 18px 10px 14px;
      border: 1px solid rgba(200,169,110,0.22);
      border-radius: 980px;
      backdrop-filter: blur(16px);
      background: rgba(3,3,3,0.45);
      color: var(--accent);
      font-size: 10px;
      font-weight: 400;
      letter-spacing: .14em;
      text-transform: uppercase;
      opacity: 0;
      transition: opacity .35s ease;
      pointer-events: none;
      user-select: none;
    }
    #scroll-velocity .sv-arrow {
      transition: transform .35s cubic-bezier(.4,0,.2,1);
      flex-shrink: 0;
    }
    #scroll-velocity[data-dir="up"] .sv-arrow { transform: rotate(180deg); }
    #scroll-velocity[data-dir="down"] .sv-arrow { transform: rotate(0deg); }
    #scroll-velocity[data-dir="up"]   .sv-label::after { content: "retrocediendo"; }
    #scroll-velocity[data-dir="down"] .sv-label::after { content: "avanzando"; }

    /* ── Video progress bar ── */
    #video-progress-bar {
      position: absolute;
      bottom: 0; left: 0; right: 0;
      height: 2px;
      background: rgba(200,169,110,0.08);
      z-index: 20;
      pointer-events: none;
    }
    #video-progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(200,169,110,0.9), rgba(200,169,110,0.3));
      will-change: width;
    }

    /* ── Noise ── */
    body::after {
      content: ''; position: fixed; inset: 0; pointer-events: none; z-index: 9997;
      opacity: 0.022;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
      background-size: 200px;
    }

    /* ── Responsive ── */
    @media (max-width: 900px) {
      .section-manifesto { grid-template-columns: 1fr; gap: 48px; }
      .feature-grid-new { grid-template-columns: 1fr; }
      .fg-card.wide { grid-column: span 1; }
      .testimonials-grid { grid-template-columns: 1fr; }
      .numbers-row { grid-template-columns: repeat(2, 1fr); }
      .timeline-item { grid-template-columns: 70px 1fr; gap: 20px; }
      nav { padding: 18px 24px; }
      .nav-links { gap: 20px; }
    }
  </style>
</head>
<body>

<div id="cursor"></div>
<div id="cursor-ring"></div>
<div id="progress-bar"></div>

<nav>
  <div class="nav-logo">Sterling</div>
  <ul class="nav-links">
    <li><a href="#">Descubrir</a></li>
    <li><a href="#">Historia</a></li>
    <li><a href="#">Trabajo</a></li>
    <li><a href="#">Contacto</a></li>
  </ul>
</nav>

<div id="chapter-dots"></div>

<div id="scroll-hint">
  <div class="mouse"></div>
  <span>Desliza</span>
</div>

<!-- ══════════════════════════════════════
     LOADER — pantalla de carga
══════════════════════════════════════ -->
<div id="loader">
  <div id="loader-inner">
    <div id="loader-logo">Santiago Sterling</div>
    <div id="loader-bar-wrap">
      <div id="loader-bar"></div>
    </div>
    <div id="loader-pct">0%</div>
    <div id="loader-label">Cargando experiencia</div>
  </div>
</div>

<!-- ══════════════════════════════════════
     ESCENA 1 — Canvas frame scrubbing (8 capítulos)
══════════════════════════════════════ -->
<div id="scene-1">
  <div id="sticky-1">

    <!-- Canvas principal: renderiza los frames del video -->
    <canvas id="main-canvas"></canvas>

    <!-- Indicador de dirección de scroll -->
    <div id="scroll-velocity" data-dir="down">
      <svg class="sv-arrow" width="14" height="14" viewBox="0 0 16 16" fill="none">
        <path d="M8 2v12M3 9l5 5 5-5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span class="sv-label"></span>
    </div>

    <!-- Barra de progreso del video -->
    <div id="video-progress-bar">
      <div id="video-progress-fill"></div>
    </div>
    <div class="top-fade"></div>
    <div class="bottom-fade"></div>
    <div class="vignette"></div>

    <div class="story-layer" id="layer-0">
      <div class="eyebrow">Prólogo</div>
      <h1>El mundo en <em>movimiento</em></h1>
      <p>Todo comienza con un instante. Desliza para descubrir lo que existe más allá del horizonte.</p>
    </div>

    <div class="story-layer" id="layer-1">
      <div class="eyebrow">Capítulo I</div>
      <h1>La <em>naturaleza</em><br/>nunca se detiene</h1>
      <p>Cada fotograma es un universo. Cada segundo, una historia que merece ser contada.</p>
      <div class="stat-row">
        <div class="stat"><div class="stat-num">∞</div><div class="stat-label">Posibilidades</div></div>
        <div class="stat"><div class="stat-num">24</div><div class="stat-label">Fotogramas / s</div></div>
        <div class="stat"><div class="stat-num">1</div><div class="stat-label">Historia</div></div>
      </div>
    </div>

    <div class="story-layer" id="layer-2">
      <div class="eyebrow">Capítulo II</div>
      <h1>Cada <em>pixel</em> importa</h1>
      <p>La belleza vive en los detalles. En la luz que cambia, en la sombra que danza.</p>
      <div class="tag-row">
        <span class="tag">Cinematografía</span>
        <span class="tag">Color grading</span>
        <span class="tag">Composición</span>
        <span class="tag">Movimiento</span>
      </div>
    </div>

    <div class="story-layer" id="layer-3">
      <div class="eyebrow">Capítulo III</div>
      <h1>El tiempo <em>fluye</em><br/>como tú quieres</h1>
      <p>Controla la narrativa. Avanza, retrocede, explora cada momento a tu ritmo. El scroll es tu línea de tiempo.</p>
    </div>

    <div class="story-layer" id="layer-4">
      <div class="eyebrow">Capítulo IV</div>
      <h1><strong>60fps</strong> de <em>emoción</em><br/>pura</h1>
      <blockquote>"El cine no captura la realidad. La reinventa segundo a segundo."</blockquote>
    </div>

    <div class="story-layer" id="layer-5">
      <div class="eyebrow">Capítulo V</div>
      <h1>La luz <em>esculpe</em><br/>cada forma</h1>
      <p>No hay dos fotogramas iguales. La luz transforma, revela, oculta. Tú decides cuándo pausar.</p>
      <div class="stat-row">
        <div class="stat"><div class="stat-num">4K</div><div class="stat-label">Resolución</div></div>
        <div class="stat"><div class="stat-num">12bit</div><div class="stat-label">Profundidad</div></div>
        <div class="stat"><div class="stat-num">HDR</div><div class="stat-label">Rango dinámico</div></div>
      </div>
    </div>

    <div class="story-layer" id="layer-6">
      <div class="eyebrow">Capítulo VI</div>
      <h1>El silencio<br/>también <em>habla</em></h1>
      <p>Un pausa en el scroll es una pausa en el tiempo. El vacío es tan expresivo como el movimiento.</p>
    </div>

    <div class="story-layer" id="layer-7">
      <div class="eyebrow">Epílogo I</div>
      <h1>La historia<br/><em>eres tú</em></h1>
      <a class="cta" href="#">
        Continúa el viaje
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
          <path d="M1 7h12M8 2l5 5-5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </a>
    </div>
  </div>
</div>

<!-- ══════════════════════════════════════
     ESCENA 2 — Color Wash (6 capítulos)
══════════════════════════════════════ -->
<div id="scene-2">
  <div id="sticky-2">
    <div id="color-bg">
      <div class="color-orb" id="orb-a"></div>
      <div class="color-orb" id="orb-b"></div>
      <div class="color-orb" id="orb-c"></div>
      <div class="color-orb" id="orb-d"></div>
    </div>
    <div class="vignette"></div>
    <div class="top-fade"></div>
    <div class="bottom-fade"></div>

    <div class="story-layer" id="layer-c0">
      <div class="eyebrow">Acto II · El color</div>
      <h1>Donde la <em>emoción</em><br/>tiene color</h1>
      <p>Cada tono evoca un estado. Cada paleta, un mundo diferente.</p>
    </div>

    <div class="story-layer" id="layer-c1">
      <div class="eyebrow">Verde · Esperanza</div>
      <h1>El verde <em>respira</em></h1>
      <p>Como el bosque después de la lluvia. Fresco, vivo, en constante crecimiento.</p>
    </div>

    <div class="story-layer" id="layer-c2">
      <div class="eyebrow">Violeta · Misterio</div>
      <h1>El violeta <em>susurra</em></h1>
      <p>Profundo como la noche. Misterioso como lo que aún no ha sido descubierto.</p>
    </div>

    <div class="story-layer" id="layer-c3">
      <div class="eyebrow">Dorado · Memoria</div>
      <h1>El dorado <em>recuerda</em></h1>
      <blockquote>"El oro no es el color del lujo. Es el color de los momentos que no queremos olvidar."</blockquote>
    </div>

    <div class="story-layer" id="layer-c4">
      <div class="eyebrow">Azul · Calma</div>
      <h1>El azul <em>escucha</em></h1>
      <p>Vasto como el océano. Sereno como el horizonte antes del amanecer.</p>
      <div class="tag-row">
        <span class="tag">Serenidad</span>
        <span class="tag">Profundidad</span>
        <span class="tag">Infinito</span>
      </div>
    </div>

    <div class="story-layer" id="layer-c5">
      <div class="eyebrow">Síntesis</div>
      <h1>Todos los colores<br/>en <em>uno</em></h1>
      <p>La paleta completa. El espectro entero. Tú eliges con qué color quieres ver el mundo.</p>
      <a class="cta" href="#">
        Ver el espectro
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
          <path d="M1 7h12M8 2l5 5-5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </a>
    </div>
  </div>
</div>

<!-- ══════════════════════════════════════
     ESCENA 3 — Mosaic / Grid (5 capítulos)
══════════════════════════════════════ -->
<div id="scene-3">
  <div id="sticky-3">
    <!-- mosaic cells filled via JS -->
    <div class="vignette" style="z-index:10;"></div>
    <div class="top-fade" style="z-index:10;"></div>
    <div class="bottom-fade" style="z-index:10;"></div>

    <div class="story-layer" id="layer-m0">
      <div class="eyebrow">Acto III · Fragmentos</div>
      <h1>El mundo en <em>pedazos</em></h1>
      <p>La realidad es un mosaico. Cada fragmento cuenta algo distinto.</p>
    </div>

    <div class="story-layer" id="layer-m1">
      <div class="eyebrow">Fragmento 01</div>
      <h1>La <em>textura</em> de las cosas</h1>
      <p>Lo rugoso y lo suave. Lo antiguo y lo nuevo. Todo coexiste en el mismo fotograma.</p>
    </div>

    <div class="story-layer" id="layer-m2">
      <div class="eyebrow">Fragmento 02</div>
      <h1>La <em>geometría</em> oculta</h1>
      <p>Cada imagen esconde un patrón. Cada patrón, una verdad sobre cómo vemos el mundo.</p>
      <div class="stat-row">
        <div class="stat"><div class="stat-num">24</div><div class="stat-label">Celdas</div></div>
        <div class="stat"><div class="stat-num">∞</div><div class="stat-label">Combinaciones</div></div>
      </div>
    </div>

    <div class="story-layer" id="layer-m3">
      <div class="eyebrow">Fragmento 03</div>
      <h1>Juntos <em>somos</em><br/>una imagen</h1>
      <p>Lo que parece caos tiene orden. Lo que parece roto está completo.</p>
    </div>

    <div class="story-layer" id="layer-m4">
      <div class="eyebrow">Acto III · Fin</div>
      <h1>El <em>todo</em><br/>y las partes</h1>
      <a class="cta" href="#">
        Explorar colección
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
          <path d="M1 7h12M8 2l5 5-5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </a>
    </div>
  </div>
</div>

<!-- ══════════════════════════════════════
     SECCIONES DE CONTENIDO
══════════════════════════════════════ -->
<div class="post-scroll">

  <!-- Manifiesto -->
  <div class="section-manifesto">
    <div class="left">
      <div class="s-eyebrow">Nuestra filosofía</div>
      <h2>Diseñado para <em>sentir</em>,<br/>no solo ver</h2>
    </div>
    <div class="right">
      <p>Cada elemento de esta experiencia fue creado con una sola intención: hacerte sentir algo real. El scroll no es navegación, es emoción. El tiempo no corre, fluye bajo tus dedos.</p>
      <p>Creemos que la web puede ser un medio tan expresivo como el cine, la fotografía o la literatura. Solo necesita ser diseñada con la misma intención.</p>
      <div class="divider"></div>
      <div class="signature">— Santiago Sterling, Fundador</div>
    </div>
  </div>

  <!-- Features -->
  <div class="section-features">
    <div class="s-header">
      <div>
        <div class="s-eyebrow">Tecnología & Arte</div>
        <h2>Lo que hace que<br/>esto sea <em>diferente</em></h2>
      </div>
      <p class="s-subtext">Seis principios que guían cada decisión de diseño y código.</p>
    </div>
    <div class="feature-grid-new">
      <div class="fg-card wide">
        <div class="fg-num">01</div>
        <h3>Scroll sincronizado al video</h3>
        <p>El video avanza y retrocede con precisión milimétrica siguiendo cada pixel de tu scroll. Interpolación suave con RAF para 60fps constantes en cualquier dispositivo.</p>
        <span class="fg-tag">Técnico</span>
      </div>
      <div class="fg-card">
        <div class="fg-num">02</div>
        <h3>Narrativa visual por capas</h3>
        <p>Cinco capítulos que emergen y desaparecen en el momento exacto en que deben ser vistos.</p>
        <span class="fg-tag">Diseño</span>
      </div>
      <div class="fg-card">
        <div class="fg-num">03</div>
        <h3>Canvas como lienzo</h3>
        <p>Fallback generativo con nebulosa animada por WebGL que responde al scroll en tiempo real.</p>
        <span class="fg-tag">Generativo</span>
      </div>
      <div class="fg-card">
        <div class="fg-num">04</div>
        <h3>Tres escenas distintas</h3>
        <p>Video scrubbing, lavado de color dinámico y mosaico fotográfico. Cada escena cuenta una historia diferente.</p>
        <span class="fg-tag">Narrativa</span>
      </div>
      <div class="fg-card">
        <div class="fg-num">05</div>
        <h3>Cursor personalizado</h3>
        <p>Un cursor fluido con lag physics que responde al contexto de la interfaz con estados múltiples.</p>
        <span class="fg-tag">UX</span>
      </div>
      <div class="fg-card">
        <div class="fg-num">06</div>
        <h3>Tipografía editorial</h3>
        <p>Playfair Display, Cormorant Garamond y DM Sans. Tres voces que crean jerarquía y ritmo visual perfecto.</p>
        <span class="fg-tag">Tipografía</span>
      </div>
    </div>
  </div>

  <!-- Timeline -->
  <div class="section-timeline">
    <div class="s-eyebrow">Proceso creativo</div>
    <h2>Cómo nace una<br/><em>experiencia</em></h2>
    <div class="timeline-item">
      <div class="timeline-year">01</div>
      <div class="timeline-content">
        <h4>Concepto & Narrativa</h4>
        <p>Todo comienza con una historia. Antes de escribir una sola línea de código, definimos qué queremos que el usuario sienta al final del recorrido.</p>
        <span class="tl-badge">Dirección creativa</span>
      </div>
    </div>
    <div class="timeline-item">
      <div class="timeline-year">02</div>
      <div class="timeline-content">
        <h4>Selección visual</h4>
        <p>El material audiovisual no es decoración. Es el vehículo principal de la emoción. Cada clip, paleta y fotografía es elegida con intención.</p>
        <span class="tl-badge">Art direction</span>
      </div>
    </div>
    <div class="timeline-item">
      <div class="timeline-year">03</div>
      <div class="timeline-content">
        <h4>Arquitectura del scroll</h4>
        <p>Mapeamos el viaje del usuario frame a frame. Cada capítulo tiene su momento de entrada, clímax y salida. El scroll es coreografía.</p>
        <span class="tl-badge">UX Design</span>
      </div>
    </div>
    <div class="timeline-item">
      <div class="timeline-year">04</div>
      <div class="timeline-content">
        <h4>Ingeniería de rendimiento</h4>
        <p>60fps en cualquier dispositivo. Interpolación suave, RAF optimizado, lazy loading y fallbacks generativos para cuando la red falla.</p>
        <span class="tl-badge">Frontend Engineering</span>
      </div>
    </div>
    <div class="timeline-item">
      <div class="timeline-year">05</div>
      <div class="timeline-content">
        <h4>Refinamiento continuo</h4>
        <p>Los detalles son lo que separa el trabajo ordinario del extraordinario. Curvas de animación, timing, microinteracciones y tipografía.</p>
        <span class="tl-badge">Craft</span>
      </div>
    </div>
  </div>

  <!-- Testimonials -->
  <div class="section-testimonials">
    <div class="inner">
      <div class="s-eyebrow">Voces que inspiran</div>
      <div class="testimonials-grid">
        <div class="test-card">
          <div class="test-quote">"Nunca pensé que desplazar un dedo pudiera sentirse como leer una novela. Esta experiencia cambió mi forma de pensar en el diseño web."</div>
          <div class="test-author">
            <div class="test-avatar">A</div>
            <div>
              <div class="test-name">Ana Beltrán</div>
              <div class="test-role">Directora Creativa, Studio K</div>
            </div>
          </div>
        </div>
        <div class="test-card">
          <div class="test-quote">"La sincronización entre el scroll y el video es perfecta. Técnicamente es impecable, pero lo que más sorprende es que no se siente como tecnología — se siente como arte."</div>
          <div class="test-author">
            <div class="test-avatar">M</div>
            <div>
              <div class="test-name">Marco Vidal</div>
              <div class="test-role">Lead Developer, Forma Studio</div>
            </div>
          </div>
        </div>
        <div class="test-card">
          <div class="test-quote">"El uso del color como narrativa en la segunda escena es lo que más me impactó. Ver cómo el verde se convierte en violeta mientras lees sobre emociones... extraordinario."</div>
          <div class="test-author">
            <div class="test-avatar">C</div>
            <div>
              <div class="test-name">Camila Reyes</div>
              <div class="test-role">UX Designer, Opal Lab</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Numbers -->
  <div class="section-numbers">
    <div class="numbers-row">
      <div class="num-cell">
        <div class="num-value">19</div>
        <div class="num-label">Capítulos</div>
        <div class="num-desc">Tres actos, diecinueve momentos únicos a través del scroll.</div>
      </div>
      <div class="num-cell">
        <div class="num-value">60fps</div>
        <div class="num-label">Fluidez</div>
        <div class="num-desc">Animaciones optimizadas para que cada fotograma sea perfecto.</div>
      </div>
      <div class="num-cell">
        <div class="num-value">3</div>
        <div class="num-label">Escenas</div>
        <div class="num-desc">Video, color y mosaico. Tres lenguajes visuales distintos.</div>
      </div>
      <div class="num-cell">
        <div class="num-value">∞</div>
        <div class="num-label">Posibilidades</div>
        <div class="num-desc">El sistema es modular. Puede crecer sin límites.</div>
      </div>
    </div>
  </div>

  <!-- CTA Final -->
  <div class="section-cta-final">
    <div class="s-eyebrow">Siguiente capítulo</div>
    <h2>¿Listo para crear<br/>tu <em>historia</em>?</h2>
    <p>Trabajamos con marcas y creadores que creen que la experiencia digital puede ser tan memorable como un film.</p>
    <div>
      <a class="btn-primary" href="#">Comenzar proyecto</a>
      <a class="btn-ghost" href="#">Ver portfolio</a>
    </div>
  </div>

  <footer>
    <div class="f-logo">Horizon</div>
    <nav class="f-nav">
      <a href="#">Trabajo</a>
      <a href="#">Proceso</a>
      <a href="#">Contacto</a>
      <a href="#">Instagram</a>
    </nav>
    <p>© 2025 · Horizon Studio</p>
  </footer>
</div>

<script>
/* ─────────────────────────────────────────
   CURSOR
───────────────────────────────────────── */
const cursor     = document.getElementById('cursor');
const cursorRing = document.getElementById('cursor-ring');
let mx = window.innerWidth/2, my = window.innerHeight/2;
let rx = mx, ry = my;
document.addEventListener('mousemove', e => { mx = e.clientX; my = e.clientY; });
(function animCursor() {
  rx += (mx - rx) * 0.14;
  ry += (my - ry) * 0.14;
  cursor.style.left = mx + 'px'; cursor.style.top = my + 'px';
  cursorRing.style.left = rx + 'px'; cursorRing.style.top  = ry + 'px';
  requestAnimationFrame(animCursor);
})();
document.querySelectorAll('a, button, .cta, .ch-dot, .fg-card, .test-card, .num-cell').forEach(el => {
  el.addEventListener('mouseenter', () => document.body.classList.add('cursor-hover'));
  el.addEventListener('mouseleave', () => document.body.classList.remove('cursor-hover'));
});

/* ─────────────────────────────────────────
   VARIABLES DE PROGRESO (declaradas aquí
   para que estén disponibles en RAF y video)
───────────────────────────────────────── */
let scene1Progress = 0, scene2Progress = 0, scene3Progress = 0;
let lastScrollY = window.scrollY;
let scrollDelta = 0;

/* ═══════════════════════════════════════════════════════════
   SISTEMA DE FRAME SCRUBBING — Técnica Apple
   ─────────────────────────────────────────────────────────
   1. Se crea un <video> oculto con el src original
   2. Se buscan N frames extrayéndolos al canvas y guardándolos
      como ImageBitmap en memoria (mucho más rápido que Image)
   3. En el scroll se dibuja el frame exacto: 0 lag, instant
   ═══════════════════════════════════════════════════════════ */

const mainCanvas = document.getElementById('main-canvas');
const mCtx       = mainCanvas.getContext('2d');

// Configuración
const TOTAL_FRAMES  = 360;   // cuántos frames extraer del video
const VIDEO_SRC     = 'https://cdn.pixabay.com/video/2024/01/27/198256-907094564_large.mp4';

// Estado
let frames          = [];   // Array de ImageBitmap
let framesLoaded    = 0;
let systemReady     = false;

// Elementos del loader
const loader        = document.getElementById('loader');
const loaderBar     = document.getElementById('loader-bar');
const loaderPct     = document.getElementById('loader-pct');

// Bloquear scroll durante carga
document.body.classList.add('loading');

// ── Redimensionar canvas al tamaño de ventana ──
function resizeMainCanvas() {
  mainCanvas.width  = window.innerWidth;
  mainCanvas.height = window.innerHeight;
  // Redibujar frame actual si ya está listo
  if (systemReady && frames.length > 0) {
    drawFrame(Math.floor(scene1Progress * (frames.length - 1)));
  }
}
window.addEventListener('resize', resizeMainCanvas);
resizeMainCanvas();

// ── Dibujar un frame en el canvas (cover) ──
function drawFrame(idx) {
  const bmp = frames[Math.max(0, Math.min(frames.length - 1, idx))];
  if (!bmp) return;
  const cw = mainCanvas.width, ch = mainCanvas.height;
  const bw = bmp.width,        bh = bmp.height;
  const scale  = Math.max(cw / bw, ch / bh);
  const dw = bw * scale, dh = bh * scale;
  const dx = (cw - dw) / 2,   dy = (ch - dh) / 2;
  mCtx.clearRect(0, 0, cw, ch);
  mCtx.drawImage(bmp, dx, dy, dw, dh);
}

// ── Extractor de frames via video oculto ──
// Crea un video invisible, lo scruba al tiempo de cada frame,
// captura el frame en un canvas temporal y lo convierte a ImageBitmap.
function extractFrames() {
  const vid = document.createElement('video');
  vid.src          = VIDEO_SRC;
  vid.muted        = true;
  vid.playsInline  = true;
  vid.preload      = 'auto';
  vid.crossOrigin  = 'anonymous';
  vid.style.display = 'none';
  document.body.appendChild(vid);

  // Canvas temporal para captura (tamaño pequeño para velocidad)
  const capW = 1280, capH = 720;
  const capCanvas = document.createElement('canvas');
  capCanvas.width = capW; capCanvas.height = capH;
  const capCtx = capCanvas.getContext('2d');

  let duration = 0;
  let currentFrameIdx = 0;

  vid.addEventListener('loadedmetadata', () => {
    duration = vid.duration;
    seekNextFrame();
  });

  // Si el video falla, mostrar fondo generativo
  vid.addEventListener('error', () => {
    console.warn('Video no disponible, usando fondo generativo');
    activateGenerativeBackground();
    dismissLoader();
  });

  setTimeout(() => {
    if (!systemReady && framesLoaded === 0) {
      console.warn('Timeout — usando fondo generativo');
      activateGenerativeBackground();
      dismissLoader();
    }
  }, 8000);

  function seekNextFrame() {
    if (currentFrameIdx >= TOTAL_FRAMES) {
      // Todos los frames capturados
      finishLoading(vid);
      return;
    }
    const t = (currentFrameIdx / (TOTAL_FRAMES - 1)) * duration;
    vid.currentTime = t;
  }

  vid.addEventListener('seeked', () => {
    // Capturar frame actual
    capCtx.drawImage(vid, 0, 0, capW, capH);

    // Convertir a ImageBitmap (más eficiente en memoria y GPU)
    createImageBitmap(capCanvas).then(bmp => {
      frames[currentFrameIdx] = bmp;
      framesLoaded++;
      currentFrameIdx++;

      // Actualizar loader
      const pct = Math.round((framesLoaded / TOTAL_FRAMES) * 100);
      loaderBar.style.width  = pct + '%';
      loaderPct.textContent  = pct + '%';

      // Mostrar primer frame en el canvas principal tan pronto llegue
      if (framesLoaded === 1) {
        drawFrame(0);
      }

      seekNextFrame();
    });
  });

  vid.load();
}

function finishLoading(vid) {
  systemReady = true;

  // Eliminar el video de extracción
  vid.remove();

  // Desbloquear scroll y ocultar loader
  dismissLoader();

  // Dibujar frame inicial
  drawFrame(0);
}

function dismissLoader() {
  document.body.classList.remove('loading');
  loader.classList.add('hidden');
}

// ── RAF: dibujar frame exacto según scroll ──
function frameScrubTick() {
  requestAnimationFrame(frameScrubTick);
  if (!systemReady || frames.length === 0) return;
  const frameIdx = Math.floor(scene1Progress * (frames.length - 1));
  drawFrame(frameIdx);
}
frameScrubTick();

// ── Indicador de velocidad de scroll ──
const scrollIndicator = document.getElementById('scroll-velocity');
const videoPFill      = document.getElementById('video-progress-fill');

function updateScrollIndicator(delta) {
  if (!scrollIndicator) return;
  if (Math.abs(delta) < 1) { scrollIndicator.style.opacity = '0'; return; }
  scrollIndicator.style.opacity = '1';
  scrollIndicator.dataset.dir = delta > 0 ? 'down' : 'up';
  clearTimeout(scrollIndicator._t);
  scrollIndicator._t = setTimeout(() => { scrollIndicator.style.opacity = '0'; }, 900);
}

// Actualizar barra de progreso del video en RAF
function rafVideoBar() {
  requestAnimationFrame(rafVideoBar);
  if (videoPFill) videoPFill.style.width = (scene1Progress * 100) + '%';
}
rafVideoBar();

// ── Fondo generativo (fallback si el video no carga) ──
let useGenerative = false;
let genT = 0;

function activateGenerativeBackground() {
  useGenerative = true;
  systemReady = true;
  animateGenerative();
}

function animateGenerative() {
  if (!useGenerative) return;
  requestAnimationFrame(animateGenerative);
  genT += 0.003 * (1 + scene1Progress * 2);
  const w = mainCanvas.width, h = mainCanvas.height;
  mCtx.clearRect(0, 0, w, h);
  const bg = mCtx.createRadialGradient(w/2, h/2, 0, w/2, h/2, w * 0.9);
  const hue = (genT * 25 + scene1Progress * 50) % 360;
  bg.addColorStop(0, `hsla(${hue},55%,8%,1)`);
  bg.addColorStop(0.5, `hsla(${(hue+50)%360},45%,4%,1)`);
  bg.addColorStop(1, 'hsl(0,0%,1%)');
  mCtx.fillStyle = bg; mCtx.fillRect(0, 0, w, h);
  [{x:.25,y:.35,r:.35,o:0},{x:.75,y:.6,r:.28,o:120},{x:.5,y:.2,r:.22,o:240}].forEach(b => {
    const cx = w*(b.x+Math.sin(genT+b.o)*.06), cy = h*(b.y+Math.cos(genT*.7+b.o)*.04);
    const gr = mCtx.createRadialGradient(cx,cy,0,cx,cy,Math.min(w,h)*b.r);
    const bh = (hue+b.o)%360;
    gr.addColorStop(0,  `hsla(${bh},70%,50%,0.18)`);
    gr.addColorStop(.5, `hsla(${bh},60%,35%,0.06)`);
    gr.addColorStop(1,  'transparent');
    mCtx.fillStyle = gr; mCtx.fillRect(0,0,w,h);
  });
  for (let i = 0; i < 180; i++) {
    const sx = ((Math.sin(i*127.1)*0.5+0.5)*w + genT*w*0.008*(i%3+0.5)) % w;
    const sy = (Math.sin(i*311.7)*0.5+0.5)*h;
    const sr = 0.4 + Math.abs(Math.sin(i*91.3+genT))*1.2;
    const sa = 0.35 + Math.sin(i*53.1+genT*2)*0.28;
    mCtx.beginPath(); mCtx.arc(sx,sy,sr,0,Math.PI*2);
    mCtx.fillStyle = `rgba(255,255,255,${sa})`; mCtx.fill();
  }
}

// ── Iniciar extracción de frames ──
extractFrames();

/* ─────────────────────────────────────────
   COLOR SCENE ORBS
───────────────────────────────────────── */
const orbA = document.getElementById('orb-a');
const orbB = document.getElementById('orb-b');
const orbC = document.getElementById('orb-c');
const orbD = document.getElementById('orb-d');
const colorBg = document.getElementById('color-bg');

const colorStates = [
  { bg:'#030303', a:0, b:0, c:0, d:0 },
  { bg:'#021208', a:0.9, b:0, c:0, d:0 },
  { bg:'#08030f', a:0, b:0.9, c:0, d:0 },
  { bg:'#0f0800', a:0, b:0, c:0.9, d:0 },
  { bg:'#010a14', a:0, b:0, c:0, d:0.9 },
  { bg:'#05060a', a:0.3, b:0.3, c:0.3, d:0.3 },
];
function applyColorState(p6) {
  const idx = Math.min(colorStates.length-2, Math.floor(p6 * (colorStates.length-1)));
  const frac = (p6 * (colorStates.length-1)) - idx;
  const s0 = colorStates[idx], s1 = colorStates[Math.min(colorStates.length-1, idx+1)];
  const lerp = (a,b,t) => a+(b-a)*t;
  orbA.style.opacity = lerp(s0.a, s1.a, frac);
  orbB.style.opacity = lerp(s0.b, s1.b, frac);
  orbC.style.opacity = lerp(s0.c, s1.c, frac);
  orbD.style.opacity = lerp(s0.d, s1.d, frac);
}

/* ─────────────────────────────────────────
   MOSAIC SETUP
───────────────────────────────────────── */
const sticky3 = document.getElementById('sticky-3');
const COLS = 6, ROWS = 4;
const mosaicImgs = [
  'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&q=70',
  'https://avatars.githubusercontent.com/u/98182135?v=4',
  'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=400&q=70',
  'https://images.unsplash.com/photo-1518020382113-a7e8fc38eac9?w=400&q=70',
  'https://images.unsplash.com/photo-1475924156734-496f6cac6ec1?w=400&q=70',
  'https://images.unsplash.com/photo-1419242902214-272b3f66ee7a?w=400&q=70',
  'https://images.unsplash.com/photo-1446329813274-7c9036bd9a1f?w=400&q=70',
  'https://images.unsplash.com/photo-1465146344425-f00d5f5c8f07?w=400&q=70',
  'https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?w=400&q=70',
  'https://avatars.githubusercontent.com/u/98182135?v=4',
  'https://images.unsplash.com/photo-1470770903676-69b98201ea1c?w=400&q=70',
  'https://images.unsplash.com/photo-1426604966848-d7adac402bff?w=400&q=70',
];
const cells = [];
for (let r=0; r<ROWS; r++) {
  for (let c=0; c<COLS; c++) {
    const cell = document.createElement('div');
    cell.className = 'mosaic-cell';
    cell.style.cssText = `grid-column:${c+1}; grid-row:${r+1};`;
    const img = document.createElement('img');
    img.src = mosaicImgs[(r*COLS+c) % mosaicImgs.length];
    img.alt = '';
    cell.appendChild(img);
    sticky3.insertBefore(cell, sticky3.firstChild);
    cells.push(cell);
  }
}
// insert overlays after cells
sticky3.querySelector('.vignette') && null; // already appended

function updateMosaic(p5) {
  // p5: 0..1 across 5 layers
  // Layer 0: all dark → gradually light cells
  const litCount = Math.floor(p5 * cells.length);
  cells.forEach((cell, i) => {
    cell.classList.toggle('lit', i < litCount);
  });
}

/* ─────────────────────────────────────────
   CHAPTER DOTS — build dynamically
───────────────────────────────────────── */
const allChapters = [
  // scene 1: 8 layers
  ...Array.from({length:8}, (_,i) => ({ scene:1, idx:i })),
  // scene 2: 6 layers
  ...Array.from({length:6}, (_,i) => ({ scene:2, idx:i })),
  // scene 3: 5 layers
  ...Array.from({length:5}, (_,i) => ({ scene:3, idx:i })),
];
const dotsContainer = document.getElementById('chapter-dots');
allChapters.forEach((ch, i) => {
  const d = document.createElement('div');
  d.className = 'ch-dot' + (i===0?' active':'');
  d.dataset.chGlobal = i;
  dotsContainer.appendChild(d);
});
const allDots = Array.from(document.querySelectorAll('.ch-dot'));

/* ─────────────────────────────────────────
   LAYERS
───────────────────────────────────────── */
const layers1 = Array.from({length:8}, (_,i) => document.getElementById('layer-'+i));
const layers2 = ['c0','c1','c2','c3','c4','c5'].map(k => document.getElementById('layer-'+k));
const layers3 = ['m0','m1','m2','m3','m4'].map(k => document.getElementById('layer-'+k));

function animateLayers(layers, p) {
  const N = layers.length;
  const idx = Math.min(N-1, Math.floor(p * N));
  const frac = (p * N) - idx;
  layers.forEach((layer, i) => {
    if (!layer) return;
    let opacity, ty;
    if (i === idx) {
      if (frac < 0.14) { opacity = frac/0.14; ty = (1-opacity)*28; }
      else if (frac > 0.82) { opacity = 1-(frac-0.82)/0.18; ty = -(1-opacity)*28; }
      else { opacity = 1; ty = 0; }
    } else {
      opacity = 0; ty = i < idx ? -28 : 28;
    }
    layer.style.opacity = Math.max(0, Math.min(1, opacity));
    layer.style.transform = `translateY(${ty}px)`;
    layer.classList.toggle('active', i===idx && opacity>0.1);
  });
  return idx;
}

/* ─────────────────────────────────────────
   SCROLL
───────────────────────────────────────── */
const scene1El = document.getElementById('scene-1');
const scene2El = document.getElementById('scene-2');
const scene3El = document.getElementById('scene-3');
const progressBar = document.getElementById('progress-bar');
const scrollHint  = document.getElementById('scroll-hint');

function getSceneProgress(el) {
  const rect = el.getBoundingClientRect();
  const total = el.offsetHeight - window.innerHeight;
  const scrolled = Math.max(0, -rect.top);
  return Math.min(1, Math.max(0, scrolled / total));
}

function totalScrollProgress() {
  const totalH = document.body.scrollHeight - window.innerHeight;
  return Math.min(1, window.scrollY / totalH);
}

let globalChapterIdx = 0;
window.addEventListener('scroll', () => {
  scene1Progress = getSceneProgress(scene1El);
  scene2Progress = getSceneProgress(scene2El);
  scene3Progress = getSceneProgress(scene3El);
  const totalP   = totalScrollProgress();

  // Indicador de dirección de scroll
  scrollDelta = window.scrollY - lastScrollY;
  lastScrollY = window.scrollY;
  updateScrollIndicator(scrollDelta);

  // Animate scene layers
  const s1idx = animateLayers(layers1, scene1Progress);
  const s2idx = animateLayers(layers2, scene2Progress);
  const s3idx = animateLayers(layers3, scene3Progress);

  // Color scene
  applyColorState(scene2Progress);

  // Mosaic
  updateMosaic(scene3Progress);

  // Progress bar
  progressBar.style.width = (totalP * 100) + '%';

  // Scroll hint
  scrollHint.style.opacity = totalP < 0.025 ? 1 : 0;

  // Global chapter index for dots
  let gIdx;
  if (scene1Progress < 1) gIdx = s1idx;
  else if (scene2Progress < 1) gIdx = 8 + s2idx;
  else gIdx = 14 + s3idx;
  if (gIdx !== globalChapterIdx) {
    globalChapterIdx = gIdx;
    allDots.forEach((d,i) => d.classList.toggle('active', i===gIdx));
  }
}, { passive: true });

// Dot click nav
allDots.forEach((dot, i) => {
  dot.addEventListener('click', () => {
    const ch = allChapters[i];
    let sceneEl, p;
    if (ch.scene === 1) { sceneEl = scene1El; p = ch.idx / 7; }
    else if (ch.scene === 2) { sceneEl = scene2El; p = ch.idx / 5; }
    else { sceneEl = scene3El; p = ch.idx / 4; }
    const top = sceneEl.offsetTop + p * (sceneEl.offsetHeight - window.innerHeight);
    window.scrollTo({ top, behavior: 'smooth' });
  });
});

// Init
window.dispatchEvent(new Event('scroll'));
if (layers1[0]) { layers1[0].style.opacity='1'; layers1[0].style.transform='translateY(0)'; }
</script>
</body>
</html>
