<!DOCTYPE html><html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sterling Social App</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --bg: #fafafa;
      --card: #fff;
      --muted: #8e8e8e;
    }
    @media (prefers-color-scheme: dark){
      :root{ --bg:#0b0b0b; --card:#0f1720; --muted:#9aa4b2; }
      body{ color: #e6eef8 }
    }
    html,body,#app{height:100%}
    body{background:var(--bg);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}/* Stories ring */
.story-ring{background:linear-gradient(45deg,#f09433,#e6683c,#dc2743,#cc2366,#bc1888);padding:2px;border-radius:9999px}

/* Parallax header */
header{backdrop-filter: blur(6px); background:rgba(255,255,255,0.6);}

/* iOS-like bounce for overscroll */
.overscroll-bounce{scroll-behavior: smooth;}

/* Post image interactions */
.post-media{touch-action: none; -webkit-user-drag: none}

/* Reels area */
.reel{min-height:60vh;display:flex;align-items:center;justify-content:center;background:#000}

/* Tiny helpers */
.ghost{opacity:.6}

  </style>
</head>
<body class="h-screen w-screen overflow-hidden">
  <div id="app" class="flex flex-col h-full"><!-- Header with parallax title -->
<header id="mainHeader" class="fixed top-0 left-0 right-0 z-40 flex items-center justify-between px-4 py-3 border-b">
  <div class="flex items-center gap-3">
    <img src="https://picsum.photos/seed/logo/40" class="w-8 h-8 rounded-full"/>
    <h1 id="appTitle" class="font-semibold text-lg select-none">SterlingApp</h1>
  </div>
  <div class="flex items-center gap-3">
    <button id="btnNewPost" title="Nuevo post">Ôºã</button>
    <button id="btnMessages">‚úâ</button>
    <button id="btnProfile">üë§</button>
  </div>
</header>

<!-- Main content area (stories + feed + reels) -->
<div id="viewport" class="pt-16 flex-1 overflow-hidden flex flex-col">

  <!-- Stories strip -->
  <section class="bg-white/60 border-b px-4 py-3 flex gap-4 overflow-x-auto story-strip">
    <div class="flex gap-4 items-center">
      <div class="story-ring"><img class="w-16 h-16 rounded-full border-2 border-white" src="https://picsum.photos/100?1"/></div>
      <div class="story-ring"><img class="w-16 h-16 rounded-full border-2 border-white" src="https://picsum.photos/100?2"/></div>
      <div class="story-ring"><img class="w-16 h-16 rounded-full border-2 border-white" src="https://picsum.photos/100?3"/></div>
      <div class="story-ring"><img class="w-16 h-16 rounded-full border-2 border-white" src="https://picsum.photos/100?4"/></div>
    </div>
  </section>

  <!-- Content panes -->
  <main id="panes" class="flex-1 overflow-y-auto overscroll-bounce touch-pan-y" style="-webkit-overflow-scrolling:touch;">

    <!-- Feed -->
    <section id="feed" class="max-w-3xl mx-auto">
    </section>

    <!-- Reels (horizontal swipe) -->
    <section id="reels" class="mt-6">
      <div class="max-w-3xl mx-auto">
        <h2 class="px-4 text-lg font-semibold">Reels</h2>
        <div id="reelsViewport" class="mt-3 overflow-hidden relative touch-action-none">
          <!-- Reel cards will be inserted here -->
        </div>
      </div>
    </section>

  </main>

</div>

<!-- Bottom navigation -->
<nav class="fixed bottom-0 left-0 right-0 bg-white/80 border-t flex justify-around py-3 z-40">
  <button id="navHome">üè† - Inicio</button>
  <button id="navSearch">üîç - Lupa</button>
  <button id="navCreate">Ôºã - Nuevo</button>
  <button id="navReels">üé¨ - Cortos</button>
  <button id="navProfile">üë§ - Perfil</button>
</nav>

<!-- Modals & Overlays -->
<div id="modals" class="fixed inset-0 z-50 pointer-events-none"></div>

  </div>  <script>
    /******************************************************************
     * NOTE:
     * - This single-file demo implements UI + client-side features.
     * - Backend hooks for Firebase/Supabase/Node.js are provided as
     *   commented placeholders. Do NOT include secrets here.
     ******************************************************************/

    /* ----------------- Simple persistent storage layer ----------------- */
    const Storage = {
      getPosts(){ return JSON.parse(localStorage.getItem('sa_posts')||'[]') },
      savePosts(list){ localStorage.setItem('sa_posts', JSON.stringify(list)) },
      getComments(){ return JSON.parse(localStorage.getItem('sa_comments')||'{}') },
      saveComments(obj){ localStorage.setItem('sa_comments', JSON.stringify(obj)) }
    }

    /* ----------------- Sample data seeding ----------------- */
    if(!localStorage.getItem('sa_seeded')){
      const sample = [{id:1, user:'maria', avatar:'https://i.pravatar.cc/40?u=1', img:'https://picsum.photos/600?1', text:'Un d√≠a genial', likes:0, created:Date.now(), type:'image'},{id:2,user:'carlos',avatar:'https://i.pravatar.cc/40?u=2',img:'https://picsum.photos/600?2',text:'Video demo',likes:0,created:Date.now()-100000,type:'video',video:'https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4'}]
      Storage.savePosts(sample); Storage.saveComments({}); localStorage.setItem('sa_seeded','1')
    }

    /* ----------------- Render feed ----------------- */
    const feedEl = document.getElementById('feed')
    function renderFeed(){
      feedEl.innerHTML = '';
      const posts = Storage.getPosts().slice().reverse();
      for(const p of posts){
        const article = document.createElement('article'); article.className='bg-white border-b my-2';
        article.innerHTML = `
          <div class="flex items-center gap-3 px-4 py-3">
            <img src="${p.avatar||'https://picsum.photos/40'}" class="w-10 h-10 rounded-full"/>
            <div class="flex-1"><div class="font-semibold">${p.user}</div><div class="text-xs text-[var(--muted)]">${new Date(p.created).toLocaleString()}</div></div>
            <button class="btn-more ghost" data-id="${p.id}">‚ãØ</button>
          </div>
          ${p.type==='video' ? `<video class="w-full max-h-[480px] post-media" controls playsinline src="${p.video}"></video>` : `<img class="w-full max-h-[600px] object-cover post-media" src="${p.img}"/>`}
          <div class="px-4 py-2 flex items-center gap-4">
            <button class="like-btn" data-id="${p.id}">‚ô° ${p.likes}</button>
            <button class="comment-btn" data-id="${p.id}">üí¨</button>
            <button class="share-btn" data-id="${p.id}">‚§¥</button>
          </div>
          <div class="px-4 pb-4"><strong>${p.user}</strong> ${p.text||''}</div>
          <div class="px-4 pb-4 comments-container" data-id="${p.id}"></div>
        `
        feedEl.appendChild(article)
      }
      attachFeedListeners()
      renderAllComments()
    }

    /* ----------------- Comments system (complete) ----------------- */
    function getCommentsForPost(postId){
      const all = Storage.getComments();
      return all[postId] || []
    }
    function addComment(postId, author, text){
      const all = Storage.getComments();
      all[postId] = all[postId]||[];
      all[postId].push({id:Date.now(),author,text,created:Date.now()});
      Storage.saveComments(all);
      renderAllComments();

      // TODO: if using backend, call saveCommentToBackend(postId, ...)
    }
    function renderAllComments(){
      document.querySelectorAll('.comments-container').forEach(c=>{
        const id=c.dataset.id; const comments = getCommentsForPost(id);
        c.innerHTML = '';
        const list = document.createElement('div');
        for(const cm of comments.slice(-3)){
          const row = document.createElement('div'); row.className='text-sm py-1';
          row.innerHTML = `<strong>${cm.author}</strong> ${cm.text} <div class='text-xs text-[var(--muted)]'>${new Date(cm.created).toLocaleString()}</div>`
          list.appendChild(row)
        }
        // input
        const form = document.createElement('div'); form.className='mt-2 flex gap-2 items-center';
        form.innerHTML = `<input class='flex-1 rounded p-2 border bg-[var(--card)]' placeholder='A√±adir comentario...' /> <button class='btn-add-comment'>Enviar</button>`
        c.appendChild(list); c.appendChild(form);
        form.querySelector('.btn-add-comment').addEventListener('click', ()=>{
          const val = form.querySelector('input').value.trim(); if(!val) return; addComment(id,'you',val); form.querySelector('input').value=''
        })
      })
    }

    /* ----------------- Feed listeners ----------------- */
    function attachFeedListeners(){
      document.querySelectorAll('.like-btn').forEach(b=>b.onclick = (e)=>{
        const id=b.dataset.id; const posts = Storage.getPosts(); const post = posts.find(x=>String(x.id)===String(id)); if(post){ post.likes = (post.likes||0)+1; Storage.savePosts(posts); renderFeed(); }
      })
      document.querySelectorAll('.comment-btn').forEach(b=>b.onclick=(e)=>{
        const id=b.dataset.id; const el = document.querySelector(`.comments-container[data-id='${id}']`); if(el){ el.querySelector('input').focus(); }
      })
      document.querySelectorAll('.btn-more').forEach(b=>b.onclick=(e)=>{
        const id=b.dataset.id; openPostActions(id)
      })
    }

    /* ----------------- Post actions modal ----------------- */
    function openPostActions(id){
      showModal(`<div class='p-4 bg-[var(--card)] rounded'>Acciones para post ${id}<div class='mt-4 flex gap-2'><button id='report'>Reportar</button><button id='delete'>Eliminar</button></div></div>`)
      document.getElementById('delete')?.addEventListener('click', ()=>{ deletePost(id); closeModal() })
    }

    function deletePost(id){
      const posts = Storage.getPosts().filter(p=>String(p.id)!==String(id)); Storage.savePosts(posts); renderFeed()
    }

    /* ----------------- Modal helper ----------------- */
    function showModal(html){
      const zone = document.getElementById('modals'); zone.innerHTML = `<div class='absolute inset-0 bg-black/40 pointer-events-auto flex items-end sm:items-center justify-center p-4'>${html}<button class='absolute top-4 right-4' id='modalClose'>‚úï</button></div>`
      document.getElementById('modalClose')?.addEventListener('click', closeModal)
    }
    function closeModal(){ document.getElementById('modals').innerHTML=''; }

    /* ----------------- New post editor with filters ----------------- */
    document.getElementById('btnNewPost').addEventListener('click', ()=>{
      showModal(`
        <div class='w-full max-w-xl bg-[var(--card)] rounded p-4'>
          <h3 class='text-lg font-semibold'>Crear publicaci√≥n</h3>
          <input id='postText' class='w-full mt-2 p-2 rounded border bg-[var(--card)]' placeholder='Escribe un pie...'>
          <input id='fileInput' type='file' accept='image/*,video/*' class='mt-2'/>
          <div class='mt-3 flex gap-2'>
            <button id='applyFilter'>Aplicar filtro</button>
            <select id='filterSelect' class='p-2 rounded'>
              <option value='none'>Normal</option>
              <option value='grayscale'>Grayscale</option>
              <option value='sepia'>Sepia</option>
              <option value='blur'>Blur</option>
              <option value='contrast'>High contrast</option>
            </select>
            <button id='publish' class='ml-auto'>Publicar</button>
          </div>
          <div id='preview' class='mt-3'></div>
        </div>
      `)

      const fileInput = document.getElementById('fileInput'); const preview = document.getElementById('preview'); let fileType='image'; let fileData=null;
      fileInput.addEventListener('change', async (e)=>{
        const f = e.target.files[0]; if(!f) return; fileType = f.type.startsWith('video') ? 'video' : 'image';
        const url = URL.createObjectURL(f); fileData = {url,type:fileType,file:f}
        preview.innerHTML = fileType==='video' ? `<video src='${url}' controls class='w-full max-h-64'></video>` : `<img src='${url}' class='w-full max-h-64 object-contain'/>`
      })

      document.getElementById('applyFilter').addEventListener('click', ()=>{
        const sel = document.getElementById('filterSelect').value;
        const img = preview.querySelector('img'); if(!img) return;
        switch(sel){
          case 'grayscale': img.style.filter='grayscale(1)'; break;
          case 'sepia': img.style.filter='sepia(0.9)'; break;
          case 'blur': img.style.filter='blur(3px)'; break;
          case 'contrast': img.style.filter='contrast(1.5)'; break;
          default: img.style.filter='none'; break;
        }
      })

      document.getElementById('publish').addEventListener('click', ()=>{
        const text = document.getElementById('postText').value;
        const posts = Storage.getPosts();
        const nxt = { id: Date.now(), user: 'you', avatar:'https://i.pravatar.cc/40?u=you', text, created:Date.now(), likes:0 }
        if(fileData){ if(fileData.type==='image'){ nxt.type='image'; nxt.img=fileData.url } else { nxt.type='video'; nxt.video=fileData.url } }
        posts.push(nxt); Storage.savePosts(posts); renderFeed(); closeModal();

        // TODO: upload file to storage (Firebase Storage / Supabase Storage) and save record in backend
      })
    })

    /* ----------------- Reels implementation with swipe/pinch gestures ----------------- */
    const reelsViewport = document.getElementById('reelsViewport');
    function seedReels(){
      const reels = Storage.getPosts().filter(p=>p.type==='video');
      reelsViewport.style.height='60vh'; reelsViewport.style.overflow='hidden'; reelsViewport.innerHTML='';
      reels.forEach((r,i)=>{
        const wrapper = document.createElement('div'); wrapper.className='reel'; wrapper.style.position='absolute'; wrapper.style.left=(i*100)+'%'; wrapper.style.top='0'; wrapper.style.width='100%'; wrapper.style.height='100%';
        wrapper.innerHTML = `<video src='${r.video}' playsinline loop controls style='max-height:100%; width:100%; object-fit:cover;'></video>`
        reelsViewport.appendChild(wrapper)
      })
      initReelGestures()
    }

    function initReelGestures(){
      let startX=0, curX=0, isDown=false, idx=0, total=reelsViewport.children.length;
      reelsViewport.addEventListener('touchstart', e=>{ isDown=true; startX=e.touches[0].clientX })
      reelsViewport.addEventListener('touchmove', e=>{ if(!isDown) return; const dx = e.touches[0].clientX - startX; reelsViewport.style.transform = `translateX(${dx}px)`; })
      reelsViewport.addEventListener('touchend', e=>{ isDown=false; const dx = (e.changedTouches[0].clientX - startX); if(Math.abs(dx)>80){ if(dx<0) idx=Math.min(total-1, idx+1); else idx=Math.max(0, idx-1) } reelsViewport.style.transition='transform .3s'; reelsViewport.style.transform = `translateX(${-idx*100}%)`; setTimeout(()=>reelsViewport.style.transition='none',350) })

      // pinch-to-zoom on individual videos/images
      let pinchStart=0, baseScale=1; reelsViewport.addEventListener('touchstart', e=>{
        if(e.touches.length===2){ const [a,b]=e.touches; pinchStart = Math.hypot(a.clientX-b.clientX,a.clientY-b.clientY); baseScale=1 }
      })
      reelsViewport.addEventListener('touchmove', e=>{
        if(e.touches.length===2){ const [a,b]=e.touches; const dist = Math.hypot(a.clientX-b.clientX,a.clientY-b.clientY); const scale = dist/pinchStart; const el = reelsViewport.children[idx]; if(el) el.style.transform = `scale(${scale})`; }
      })
      reelsViewport.addEventListener('touchend', e=>{ reelsViewport.querySelectorAll('.reel').forEach(r=>r.style.transform='none') })
    }

    /* ----------------- Parallax header effect ----------------- */
    const header = document.getElementById('mainHeader');
    document.querySelector('#panes').addEventListener('scroll', e=>{
      const y = e.target.scrollTop; header.style.backdropFilter = `blur(${Math.min(10,y/50)}px)`; document.getElementById('appTitle').style.transform = `translateY(${Math.min(0,y/20)}px)`
    })

    /* ----------------- Touch gestures for feed (inertial scroll & bounce) ----------------- */
    (function inertialScroll(){
      const sc = document.querySelector('#panes');
      let vy=0, lastY=0, ticking=false;
      sc.addEventListener('touchstart', (e)=>{ vy=0; lastY = e.touches[0].clientY })
      sc.addEventListener('touchmove', (e)=>{ const y = e.touches[0].clientY; vy = y - lastY; lastY = y })
      sc.addEventListener('touchend',(e)=>{ // implement a tiny inertia
        let vel = vy*4; if(Math.abs(vel)>1){ let t=0; const step = ()=>{ t++; sc.scrollTop -= vel* (0.92**t); if(Math.abs(vel*(0.92**t))>0.5 && t<60) requestAnimationFrame(step); }
        requestAnimationFrame(step)
        }
      })
    })()

    /* ----------------- Basic auth placeholders (Firebase / Supabase) ----------------- */
    // FIREBASE: to enable, add your Firebase config here and call firebase.initializeApp({...})
    // then use firebase.auth().signInWithEmailAndPassword(...) or firebase.auth().onAuthStateChanged(...)

    // SUPABASE: to enable, include supabase client and call createClient(url, anonKey)

    // For demo we simulate a simple login modal
    function openLogin(){
      showModal(`<div class='p-4 bg-[var(--card)] rounded w-full max-w-md'>
        <h3 class='text-lg font-semibold'>Iniciar sesi√≥n</h3>
        <input id='li_email' class='w-full p-2 rounded mt-2' placeholder='email'/>
        <input id='li_pass' type='password' class='w-full p-2 rounded mt-2' placeholder='contrase√±a'/>
        <div class='mt-3 flex gap-2'><button id='doLogin'>Entrar</button><button id='doGuest'>Invitado</button></div>
      </div>`)
      document.getElementById('doLogin').addEventListener('click', ()=>{ const e=document.getElementById('li_email').value; const p=document.getElementById('li_pass').value; // validate
        // TODO: call backend auth
        localStorage.setItem('sa_user', e||'you'); closeModal(); renderFeed();
      })
      document.getElementById('doGuest').addEventListener('click', ()=>{ localStorage.setItem('sa_user','guest'); closeModal(); renderFeed() })
    }

    document.getElementById('btnProfile').addEventListener('click', openLogin)
    document.getElementById('navProfile').addEventListener('click', openLogin)

    /* ----------------- Profile & settings view (client-side) ----------------- */
    function openProfile(){
      const user = localStorage.getItem('sa_user')||'guest'
      showModal(`<div class='p-4 bg-[var(--card)] rounded w-full max-w-md'>
        <h3 class='text-lg font-semibold'>Perfil ‚Äî ${user}</h3>
        <div class='mt-2'>Tema: <span id='themeInfo'></span></div>
        <div class='mt-4'><button id='logout'>Cerrar sesi√≥n</button></div>
      </div>`)
      document.getElementById('themeInfo').textContent = window.matchMedia('(prefers-color-scheme:dark)').matches ? 'Oscuro (auto)' : 'Claro (auto)'
      document.getElementById('logout').addEventListener('click', ()=>{ localStorage.removeItem('sa_user'); closeModal(); })
    }
    document.getElementById('navProfile').addEventListener('click', openProfile)

    /* ----------------- Basic search stub ----------------- */
    document.getElementById('navSearch').addEventListener('click', ()=>{ showModal('<div class="p-4 bg-[var(--card)] rounded">Buscador (placeholder)</div>') })

    /* ----------------- Init application ----------------- */
    function init(){ renderFeed(); seedReels(); setupRealtimeBackendHooks(); }
    init()

    /* ----------------- Backend placeholders & notes ----------------- */
    function setupRealtimeBackendHooks(){
      // Example: When connected to Firebase Realtime DB or Supabase realtime channels,
      // subscribe to new posts/comments and call renderFeed() or renderAllComments().
      // PSEUDO:
      // firebase.database().ref('posts').on('child_added', snap=>{ /* merge into local */ })
    }

    /* ----------------- Export utilities: Node.js starter for backend ----------------- */
    /*
      Node.js (Express) starter to store posts/comments:

      const express = require('express');
      const app = express();
      app.use(express.json());
      let posts = [];
      app.get('/posts', (req,res)=>res.json(posts));
      app.post('/posts', (req,res)=>{ posts.push(req.body); res.json({ok:true}); });
      app.post('/comments', (req,res)=>{ // store comments });
      app.listen(3000,()=>console.log('api running'));

      For production use a DB (Postgres / MongoDB) and storage (S3 / Cloud Storage).
    */

    /* ----------------- Keyboard & small UX tweaks ----------------- */
    document.addEventListener('visibilitychange', ()=>{ if(document.hidden) document.querySelectorAll('video').forEach(v=>v.pause()) })

  </script></body>
</html>
