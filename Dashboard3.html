<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LiquidGlass — Mini Red Social de Videos (iOS-like)</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Prefer system iOS-like font stack */
    :root{
      --glass-bg: rgba(255,255,255,0.12);
      --glass-border: rgba(255,255,255,0.22);
      --accent: linear-gradient(90deg,#6ee7b7,#60a5fa 60%);
      --card-radius: 18px;
      color-scheme: light;
    }
    @media (prefers-color-scheme: dark){
      :root{ --glass-bg: rgba(8,10,15,0.36); --glass-border: rgba(255,255,255,0.06); color-scheme: dark; }
    }

    html,body{ height:100%; background: radial-gradient(1200px 600px at 10% 10%, rgba(96,165,250,0.08), transparent 10%), radial-gradient(900px 450px at 90% 90%, rgba(110,231,183,0.06), transparent 10%), #0b1020; font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }

    /* iPhone-like container */
    .device {
      width: 390px; max-width: calc(100% - 40px); height: 844px;
      border-radius: 52px; padding: 22px; box-sizing: border-box;
      background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow:
        0 20px 40px rgba(0,0,0,0.55),
        inset 0 1px 1px rgba(255,255,255,0.25),
        inset 0 -1px 2px rgba(0,0,0,0.35);
      backdrop-filter: blur(26px) saturate(160%);
      -webkit-backdrop-filter: blur(26px) saturate(160%);
      transition: all .3s ease;
    }

    /* Liquid glass card */
    .glass {
      background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.04));
      border: 1px solid rgba(255,255,255,0.22);
      border-radius: var(--card-radius);
      backdrop-filter: blur(22px) saturate(180%);
      -webkit-backdrop-filter: blur(22px) saturate(180%);
      box-shadow:
        0 6px 18px rgba(2,6,23,0.55),
        inset 0 1px 0 rgba(255,255,255,0.25);
      transition: all .25s ease;
    }

    /* Floating action + smooth interactions */
    .floating { transform: translateZ(0); transition: transform .28s cubic-bezier(.2,.9,.3,1), box-shadow .28s; }
    .floating:active{ transform: translateY(3px) scale(.997); }

    /* Video thumb styles */
    .thumb{
      border-radius: 18px;
      overflow: hidden;
      background: #000;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: 0 6px 20px rgba(0,0,0,0.45);
      transition: transform .28s ease, box-shadow .28s ease;
    }
    .thumb:hover{
      transform: scale(1.025);
      box-shadow: 0 12px 26px rgba(0,0,0,0.55);
    }
    .thumb video{ width:100%; height:100%; object-fit:cover; display:block; }

    /* bottom iOS tab blur */
    .tabbar{
      position:relative; padding:14px; border-radius:22px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.15);
      backdrop-filter: blur(26px) saturate(200%);
      -webkit-backdrop-filter: blur(26px) saturate(200%);
      box-shadow: 0 8px 26px rgba(0,0,0,0.55), inset 0 1px 0 rgba(255,255,255,0.2);
    }

    /* responsive - show device in center on large screens */
    @media(min-width:900px){ body{ display:flex; align-items:center; justify-content:center; } }

    /* subtle glass borders inside feed */
    .meta { color: rgba(255,255,255,0.9); }

    /* player modal */
    .player-modal{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg, rgba(2,6,23,0.6), rgba(2,6,23,0.85)); z-index:60; }

  </style>
</head>
<body>
  <div class="min-h-screen flex items-center justify-center p-6">
    <!-- Device frame -->
    <div class="device glass mx-auto relative">

      <!-- Top status bar -->
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center gap-2">
          <div class="w-9 h-9 rounded-xl glass flex items-center justify-center text-sm font-semibold">LG</div>
          <div class="text-xs meta">LiquidGlass</div>
        </div>
        <div class="text-xs meta">9:41 AM</div>
      </div>

      <!-- Search + upload -->
      <div class="flex items-center gap-3 mb-4">
        <div class="flex-1 glass p-2 rounded-xl flex items-center gap-3">
          <svg class="w-5 h-5 opacity-70" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 21l-4.35-4.35" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path><circle cx="11" cy="11" r="6" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></circle></svg>
          <input id="search" placeholder="Buscar videos, usuarios..." class="bg-transparent outline-none text-sm w-full text-white/90" />
        </div>
        <label for="upload" class="glass p-2 rounded-xl floating cursor-pointer" title="Subir video">
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 3v12" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path><path d="M8 7l4-4 4 4" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path><path d="M5 21h14" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path></svg>
        </label>
        <input id="upload" type="file" accept="video/*" class="hidden" />
      </div>

      <!-- Stories / Horizontal scroller -->
      <div class="mb-4">
        <div class="flex gap-3 overflow-x-auto pb-3">
          <!-- story template -->
          <div class="min-w-[78px] glass p-3 rounded-2xl flex flex-col items-center gap-2">
            <div class="w-14 h-14 rounded-full thumb overflow-hidden"><img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'><rect width='100%' height='100%' fill='%2360a5fa'/><text x='50%' y='55%' font-size='36' fill='white' font-family='Arial' text-anchor='middle'>A</text></svg>" alt="avatar"></div>
            <div class="text-xs meta">Ana</div>
          </div>
          <div class="min-w-[78px] glass p-3 rounded-2xl flex flex-col items-center gap-2">
            <div class="w-14 h-14 rounded-full thumb overflow-hidden"><img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'><rect width='100%' height='100%' fill='%236ee7b7'/><text x='50%' y='55%' font-size='36' fill='white' font-family='Arial' text-anchor='middle'>S</text></svg>" alt="avatar"></div>
            <div class="text-xs meta">Santi</div>
          </div>
          <div class="min-w-[78px] glass p-3 rounded-2xl flex flex-col items-center gap-2">
            <div class="w-14 h-14 rounded-full thumb overflow-hidden"><img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'><rect width='100%' height='100%' fill='%23fbbf24'/><text x='50%' y='55%' font-size='36' fill='white' font-family='Arial' text-anchor='middle'>L</text></svg>" alt="avatar"></div>
            <div class="text-xs meta">Luci</div>
          </div>
        </div>
      </div>

      <!-- Feed -->
      <div id="feed" class="space-y-4 overflow-y-auto" style="height: calc(100% - 220px); padding-right:6px;">
        <!-- JS will populate feed cards -->
      </div>

      <!-- Bottom tab bar -->
      <div class="absolute left-6 right-6 bottom-6 glass tabbar flex items-center justify-between px-3">
        <div class="flex items-center gap-4">
          <button class="p-2 rounded-xl floating" id="homeBtn" aria-label="Inicio">
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 11l9-7 9 7" stroke-width="1.6"></path><path d="M9 22V12h6v10" stroke-width="1.6"></path></svg>
          </button>
          <button class="p-2 rounded-xl floating" id="searchBtn" aria-label="Explorar">
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="11" cy="11" r="6" stroke-width="1.6"></circle><path d="M21 21l-4.35-4.35" stroke-width="1.6"></path></svg>
          </button>
        </div>
        <div class="flex items-center gap-3">
          <button id="createBtn" class="p-2 rounded-full floating glass" title="Crear">
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 5v14M5 12h14" stroke-width="1.6" stroke-linecap="round"></path></svg>
          </button>
        </div>
        <div class="flex items-center gap-4">
          <button class="p-2 rounded-xl floating" id="inboxBtn" aria-label="Bandeja">
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 7h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke-width="1.6"></path><path d="M7 7V5a5 5 0 0 1 10 0v2" stroke-width="1.6"></path></svg>
          </button>
          <button class="p-2 rounded-xl floating" id="profileBtn" aria-label="Perfil">
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="8" r="3" stroke-width="1.6"></circle><path d="M5.5 21a6.5 6.5 0 0 1 13 0" stroke-width="1.6"></path></svg>
          </button>
        </div>
      </div>

    </div>
  </div>

  <!-- Player modal template -->
  <div id="playerModal" class="player-modal hidden" aria-hidden="true">
    <div class="glass p-4 rounded-2xl max-w-[920px] w-full" style="max-height:90vh;">
      <div id="playerWrapper" class="w-full h-[64vh] bg-black rounded-xl overflow-hidden mb-3">
        <!-- video inserted here -->
      </div>
      <div class="flex items-center justify-between">
        <div>
          <div id="playerTitle" class="text-white font-semibold">Título del video</div>
          <div id="playerMeta" class="text-sm text-white/70">@autor • 0 vistas</div>
        </div>
        <div>
          <button id="closePlayer" class="glass p-2 rounded-xl">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Minimal mock feed and interactions
    const initialFeed = [
      { id:1, author:'Ana', title:'Atardecer en la ciudad', views: '1.2K', src: null },
      { id:2, author:'Santiago', title:'Tip de productividad', views: '3.4K', src: null },
      { id:3, author:'Lucía', title:'Receta rápida', views: '840', src: null }
    ];

    const feedEl = document.getElementById('feed');
    const upload = document.getElementById('upload');
    const playerModal = document.getElementById('playerModal');
    const playerWrapper = document.getElementById('playerWrapper');
    const playerTitle = document.getElementById('playerTitle');
    const playerMeta = document.getElementById('playerMeta');

    function createCard(item){
      const card = document.createElement('div');
      card.className = 'glass p-3 rounded-2xl flex gap-3 items-start';

      const left = document.createElement('div');
      left.className = 'w-36 h-48 thumb rounded-xl overflow-hidden flex-shrink-0';

      // If item.src present, show video element, else show placeholder poster
      if(item.src){
        const v = document.createElement('video');
        v.src = item.src; v.muted = true; v.loop = true; v.playsInline = true; v.autoplay = true;
        v.addEventListener('click', ()=> openPlayer(item));
        left.appendChild(v);
      } else {
        const img = document.createElement('div');
        img.style.width='100%'; img.style.height='100%'; img.style.display='flex'; img.style.alignItems='center'; img.style.justifyContent='center';
        img.innerHTML = `<svg width='120' height='120' viewBox='0 0 24 24' fill='none' stroke='white'><path d='M21 15V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v8'></path><rect x='3' y='11' width='18' height='10' rx='2'></rect></svg>`;
        left.appendChild(img);
      }

      const right = document.createElement('div');
      right.className = 'flex-1';
      right.innerHTML = `
        <div class='flex items-center justify-between mb-2'>
          <div>
            <div class='text-sm font-semibold meta'>${item.title}</div>
            <div class='text-xs text-white/70'>@${item.author} • ${item.views} vistas</div>
          </div>
          <div class='flex items-center gap-2'>
            <button class='p-2 glass rounded-xl floating likeBtn' title='Me gusta'>
              <svg class='w-5 h-5' viewBox='0 0 24 24' fill='none' stroke='currentColor'><path d='M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z'></path></svg>
            </button>
            <button class='p-2 glass rounded-xl floating' title='Compartir'>
              <svg class='w-5 h-5' viewBox='0 0 24 24' fill='none' stroke='currentColor'><path d='M4 12v8a2 2 0 0 0 2 2h12'></path><path d='M16 6l-4-4-4 4'></path></svg>
            </button>
          </div>
        </div>
        <div class='text-sm text-white/70'>Descripción breve que resume el video. Tap para ver en grande.</div>
      `;

      // click on card to open player
      card.addEventListener('click', (e)=>{
        // avoid clicks on like/share
        if(e.target.closest('.likeBtn') || e.target.closest('button')) return;
        openPlayer(item);
      });

      card.insertBefore(left, card.firstChild);
      card.appendChild(right);
      return card;
    }

    function renderFeed(items){
      feedEl.innerHTML = '';
      items.forEach(i=> feedEl.appendChild(createCard(i)));
    }

    function openPlayer(item){
      playerWrapper.innerHTML = '';
      const v = document.createElement('video');
      v.controls = true; v.autoplay = true; v.playsInline = true; v.style.width='100%'; v.style.height='100%'; v.style.objectFit='contain';
      if(item.src) v.src = item.src; else {
        // show a short data-URI demo placeholder (silent black video isn't practical). Instead show an animated SVG poster with play button overlay
        playerWrapper.innerHTML = `<div style='width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:white'><div style='text-align:center'><svg width='120' height='120' viewBox='0 0 24 24' fill='none' stroke='white'><path d='M21 15V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v8'></path><rect x='3' y='11' width='18' height='10' rx='2'></rect></svg><div style='margin-top:12px;color:#ddd'>Video de demostración</div></div></div>`;
        playerModal.classList.remove('hidden'); playerModal.setAttribute('aria-hidden','false');
        playerTitle.textContent = item.title;
        playerMeta.textContent = `@${item.author} • ${item.views} vistas`;
        return;
      }
      playerWrapper.appendChild(v);
      playerModal.classList.remove('hidden'); playerModal.setAttribute('aria-hidden','false');
      playerTitle.textContent = item.title;
      playerMeta.textContent = `@${item.author} • ${item.views} vistas`;
    }

    document.getElementById('closePlayer').addEventListener('click', ()=>{
      playerModal.classList.add('hidden'); playerModal.setAttribute('aria-hidden','true');
      playerWrapper.innerHTML = '';
    });

    // upload handling - add to top of feed
    upload.addEventListener('change', (e)=>{
      const file = e.target.files[0];
      if(!file) return;
      const url = URL.createObjectURL(file);
      const newItem = { id:Date.now(), author:'Tú', title:file.name, views:'0', src:url };
      initialFeed.unshift(newItem);
      renderFeed(initialFeed);
      // reset input
      upload.value = '';
    });

    // search simple filter
    document.getElementById('search').addEventListener('input', (e)=>{
      const q = e.target.value.toLowerCase();
      if(!q) return renderFeed(initialFeed);
      renderFeed(initialFeed.filter(i => (i.title||'').toLowerCase().includes(q) || (i.author||'').toLowerCase().includes(q)));
    });

    // initial render
    renderFeed(initialFeed);

    // small UX: pause videos when modal open or page hidden
    document.addEventListener('visibilitychange', ()=>{
      document.querySelectorAll('video').forEach(v=>{ if(document.hidden) v.pause(); else v.play().catch(()=>{}); });
    });

    // keyboard escape to close
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ document.getElementById('closePlayer').click(); } });

    // responsive behavior: allow dragging to scroll feed on touch
    let startY=0; const feed = document.getElementById('feed');
    feed.addEventListener('touchstart',(e)=>{ startY = e.touches[0].clientY; });

  </script>



<!-- iOS Advanced Animations & Multitouch Enhancements -->
<style>
  /* Parallax tilt for cards */
  .tilt {
    transform-style: preserve-3d;
    transition: transform .25s ease;
  }
  .tilt:hover {
    transform: perspective(900px) rotateY(var(--tiltX)) rotateX(var(--tiltY));
  }

  /* iOS-style spring animation */
  @keyframes iosSpring {
    0% { transform: scale(0.95); }
    60% { transform: scale(1.03); }
    100% { transform: scale(1); }
  }
  .tapSpring { animation: iosSpring .3s cubic-bezier(.25,.7,.35,1); }

  /* Smooth fade/slide for feed */
  @keyframes feedAppear {
    from { opacity:0; transform: translateY(20px); }
    to { opacity:1; transform: translateY(0); }
  }
  .feedItem { animation: feedAppear .5s ease forwards; }

  /* Premium icons (iOS style) */
  .icon-ios {
    width: 28px; height: 28px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.25));
  }
</style>

<script>
// MULTITOUCH: pinch zoom + rotation for videos
let activeVideo = null;

function enableGestures(el){
  let initialDistance = 0;
  let initialScale = 1;
  let rotation = 0;
  let initialAngle = 0;

  el.addEventListener('touchstart', e => {
    if (e.touches.length === 2){
      const dx = e.touches[0].clientX - e.touches[1].clientX;
      const dy = e.touches[0].clientY - e.touches[1].clientY;
      initialDistance = Math.hypot(dx, dy);
      initialAngle = Math.atan2(dy, dx);
    }
  });

  el.addEventListener('touchmove', e => {
    if (e.touches.length === 2){
      const dx = e.touches[0].clientX - e.touches[1].clientX;
      const dy = e.touches[0].clientY - e.touches[1].clientY;
      const newDistance = Math.hypot(dx, dy);
      const newAngle = Math.atan2(dy, dx);

      const scale = newDistance / initialDistance;
      const angleDeg = (newAngle - initialAngle) * (180 / Math.PI);

      el.style.transform = `scale(${scale}) rotate(${angleDeg}deg)`;
    }
  });

  el.addEventListener('touchend', () => {
    el.style.transform = "";
  });
}

// Apply gestures to video thumbnails
document.querySelectorAll('.thumb').forEach(v => enableGestures(v));

// INTERACTION: tap animation on cards
function tapFeedback(el){
  el.classList.add('tapSpring');
  setTimeout(() => el.classList.remove('tapSpring'), 350);
}
document.querySelectorAll('.glass, .thumb').forEach(el =>{
  el.addEventListener('click', () => tapFeedback(el));
});

// ICON ENHANCEMENT: replace SVGs with iOS premium icons
const iconMap = {
  home: "https://cdn.jsdelivr.net/gh/iconoir-icons/iconoir/icons/home.svg",
  search: "https://cdn.jsdelivr.net/gh/iconoir-icons/iconoir/icons/search.svg",
  add: "https://cdn.jsdelivr.net/gh/iconoir-icons/iconoir/icons/plus.svg",
  video: "https://cdn.jsdelivr.net/gh/iconoir-icons/iconoir/icons/play-outline.svg",
  user: "https://cdn.jsdelivr.net/gh/iconoir-icons/iconoir/icons/profile-circle.svg"
};

document.querySelectorAll('[data-icon]').forEach(i =>{
  const name = i.getAttribute('data-icon');
  if(iconMap[name]) i.src = iconMap[name];
});

</script>

</body>

<!-- Dark mode enhancements, Dynamic Island, Haptics, Advanced Player Gestures, Infinite Feed -->
<style>
  /* Dark mode vars */
  @media (prefers-color-scheme: dark){
    :root{
      --glass-bg: rgba(7,10,15,0.5);
      --glass-border: rgba(255,255,255,0.04);
      --accent: linear-gradient(90deg,#3ddc84,#60a5fa 60%);
      background: radial-gradient(900px 450px at 10% 10%, rgba(96,165,250,0.03), transparent 10%), radial-gradient(700px 350px at 90% 90%, rgba(110,231,183,0.02), transparent 10%), #02040a;
    }
    body { color: #e6eef8; }
    .glass { background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04); }
  }

  /* Dynamic Island */
  .dynamic-island{
    position:absolute; left:50%; top:8px; transform:translateX(-50%);
    min-width:120px; max-width:220px; height:36px; border-radius:20px;
    background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    border:1px solid rgba(255,255,255,0.08);
    display:flex; align-items:center; gap:8px; padding:6px 10px; z-index:80;
    box-shadow: 0 6px 18px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.18);
    backdrop-filter: blur(14px) saturate(160%);
  }
  .dynamic-island.hidden{ opacity:0; transform:translateX(-50%) scale(.95); transition: all .22s ease; pointer-events:none; }
  .dynamic-island.show{ opacity:1; transform:translateX(-50%) scale(1); transition: all .22s cubic-bezier(.2,.9,.3,1); }
  .dynamic-island img{ width:24px; height:24px; border-radius:6px; }
  .dynamic-island .di-text{ font-size:12px; color:rgba(255,255,255,0.92); }

  /* Skeleton loaders */
  .skeleton{ background: linear-gradient(90deg,#ffffff10,#ffffff14,#ffffff10); background-size:200% 100%; animation:shimmer 1.2s linear infinite; border-radius:12px; }
  @keyframes shimmer{ from{ background-position:200% 0 } to{ background-position:-200% 0 } }

  .skeleton-thumb{ width:140px; height:160px; border-radius:12px; }
  .skeleton-line{ height:12px; width:80%; border-radius:8px; margin-top:8px }

  /* Player advanced overlay controls */
  .player-overlay{ position:absolute; right:14px; top:50%; transform:translateY(-50%); display:flex; flex-direction:column; gap:6px; z-index:90; }
  .volume-indicator{ width:36px; height:120px; border-radius:14px; background:rgba(255,255,255,0.06); display:flex; align-items:flex-end; padding:6px; box-shadow: 0 8px 20px rgba(0,0,0,0.5); }
  .volume-fill{ width:100%; background:linear-gradient(180deg,#60a5fa,#3ddc84); border-radius:10px; }

  /* small helper for brightness overlay */
  .brightness-overlay{ position:absolute; inset:0; pointer-events:none; background:linear-gradient(180deg, rgba(0,0,0,0.0), rgba(0,0,0,0.0)); z-index:85; }
</style>

<script>
// DYNAMIC ISLAND: show temporary notifications like a native iPhone
const device = document.querySelector('.device');
const di = document.createElement('div');
di.className = 'dynamic-island hidden';
di.innerHTML = `<img src='data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=24 height=24><rect width=24 height=24 rx=6 fill=%2360a5fa/></svg>'/><div class='di-text'>Reproduciendo • LiquidGlass</div>`;
device.appendChild(di);
function showDynamicIsland(text, iconSVG){
  di.querySelector('.di-text').textContent = text;
  if(iconSVG) di.querySelector('img').src = iconSVG;
  di.classList.remove('hidden'); di.classList.add('show');
  setTimeout(()=>{ di.classList.remove('show'); di.classList.add('hidden'); }, 2400);
}

// HAPTICS: use Vibration API where available
function haptic(duration=10){ if(navigator.vibrate) navigator.vibrate(duration); }

// Hook haptics to interactive elements
document.addEventListener('click', (e)=>{
  const btn = e.target.closest('button, label, .glass, .thumb');
  if(btn) haptic(8);
});

// ADVANCED PLAYER GESTURES: double-tap to seek 10s, swipe down to close, vertical drag for volume/brightness
let activeV = null;
let lastTap = 0;

function attachPlayerGestures(video){
  let startY = 0; let startX = 0; let touching = false; let isVolume = false;
  video.addEventListener('touchstart', (ev)=>{
    touching = true;
    startY = ev.touches[0].clientY; startX = ev.touches[0].clientX;
    const now = Date.now();
    if(now - lastTap < 300){ // double tap
      // determine left or right half
      const rect = video.getBoundingClientRect();
      const x = ev.touches[0].clientX - rect.left;
      if(x < rect.width/2){ video.currentTime = Math.max(0, video.currentTime - 10); showDynamicIsland('Rebobinando 10s'); }
      else { video.currentTime = Math.min(video.duration || 0, video.currentTime + 10); showDynamicIsland('Adelantar 10s'); }
    }
    lastTap = now;
  });

  video.addEventListener('touchmove', (ev)=>{
    if(!touching) return;
    const dy = ev.touches[0].clientY - startY;
    const dx = ev.touches[0].clientX - startX;
    // vertical gesture dominates: right half -> volume, left half -> brightness
    const rect = video.getBoundingClientRect();
    const x = ev.touches[0].clientX - rect.left;
    if(Math.abs(dy) > Math.abs(dx) && Math.abs(dy) > 8){
      if(x > rect.width/2) { // volume
        isVolume = true;
        const change = -dy/200; // small delta
        try{ video.volume = Math.min(1, Math.max(0, video.volume + change)); }
        catch(e){}
        showVolumeIndicator(video.volume);
      } else { // brightness (simulated)
        const change = dy/500;
        const overlay = document.querySelector('.brightness-overlay');
        let cur = parseFloat(overlay.dataset.level || '0'); cur = Math.min(0.7, Math.max(0, cur + change));
        overlay.dataset.level = cur; overlay.style.background = `linear-gradient(180deg, rgba(0,0,0,${cur}), rgba(0,0,0,${cur}))`;
      }
    }
  });

  video.addEventListener('touchend', (ev)=>{
    touching = false; isVolume = false; hideVolumeIndicator();
    // if swipe down quickly -> close player
    const endY = ev.changedTouches && ev.changedTouches[0] ? ev.changedTouches[0].clientY : 0;
    if(endY - startY > 120){ document.getElementById('closePlayer').click(); }
  });
}

// Volume indicator UI
let volTimer = null;
function showVolumeIndicator(level){
  let overlay = document.getElementById('volumeOverlay');
  if(!overlay){ overlay = document.createElement('div'); overlay.id='volumeOverlay'; overlay.className='player-overlay';
    overlay.innerHTML = `<div class='volume-indicator'><div class='volume-fill' style='height:${Math.round(level*100)}%'></div></div>`;
    document.body.appendChild(overlay);
  } else {
    overlay.querySelector('.volume-fill').style.height = Math.round(level*100)+'%';
  }
  overlay.style.opacity = 1;
  clearTimeout(volTimer); volTimer = setTimeout(()=> hideVolumeIndicator(), 900);
}
function hideVolumeIndicator(){ const overlay = document.getElementById('volumeOverlay'); if(overlay) overlay.style.opacity = 0; }

// Override openPlayer to attach gestures and show Dynamic Island
const originalOpen = window.openPlayer;
window.openPlayer = function(item){
  originalOpen(item);
  const video = document.querySelector('#playerWrapper video');
  if(video){
    attachPlayerGestures(video);
    // show dynamic island with author
    showDynamicIsland(`Reproduciendo • @${item.author}`);
  }
};

// INFINITE SCROLL + SKELETON LOADERS
let loadingMore = false; let page = 0;
function createSkeletonCard(){
  const s = document.createElement('div'); s.className='glass p-3 rounded-2xl flex gap-3 items-start feedItem';
  s.innerHTML = `<div class='skeleton-thumb skeleton'></div><div class='flex-1'><div class='skeleton-line skeleton'></div><div class='skeleton-line skeleton' style='width:60%'></div></div>`;
  return s;
}
function generateFakeItem(i){ return { id: 'n'+Date.now()+i, author: 'User'+(100+i), title: 'Video recomendado '+(page*3+i+1), views: Math.floor(Math.random()*9000)+'' } }

feedEl.addEventListener('scroll', async function(){
  const scrollBottom = feedEl.scrollTop + feedEl.clientHeight;
  if(scrollBottom >= feedEl.scrollHeight - 120 && !loadingMore){
    loadingMore = true; page++;
    // add 3 skeletons
    const skels = [createSkeletonCard(), createSkeletonCard(), createSkeletonCard()];
    skels.forEach(s=> feedEl.appendChild(s));
    // mimic network
    setTimeout(()=>{
      skels.forEach((sk,i)=>{
        const it = generateFakeItem(i);
        feedEl.replaceChild(createCard(it), sk);
      });
      loadingMore = false;
    }, 900 + Math.random()*700);
  }
});

// Ensure initial feed items have subtle appear animation
document.querySelectorAll('#feed .glass').forEach((el, idx)=>{ el.classList.add('feedItem'); el.style.animationDelay = (idx*80)+'ms'; });

// small cleanup: ensure new cards have tilt and premium icons
const observer = new MutationObserver(muts=>{
  muts.forEach(m=> m.addedNodes && m.addedNodes.forEach(n=>{
    if(n.nodeType===1 && n.classList.contains('glass')){
      n.classList.add('tilt');
    }
  }))
});
observer.observe(feedEl, { childList:true });

</script>
</html>
