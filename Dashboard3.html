<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cuentas</title>

<link rel='stylesheet' href='https://cdn-uicons.flaticon.com/3.0.0/uicons-solid-rounded/css/uicons-solid-rounded.css'>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
:root{
  --bg:#f5f5f7;
  --card:rgba(255,255,255,.85);
  --border:rgba(0,0,0,.08);
  --accent:#007aff;
  --text:#1c1c1e;
  --muted:#6e6e73;
  --radius:18px;
  --blur:22px;
}

*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text",sans-serif}

body{
  margin:0;
  background:linear-gradient(180deg,#fff,#eaeaee);
  color:var(--text);
  height:100vh;
  display:flex;
  overflow:hidden;
}

.app{
  display:flex;
  width:100%;
}

/* Sidebar */
.sidebar{
  width:280px;
  background:var(--card);
  backdrop-filter:blur(var(--blur));
  border-right:1px solid var(--border);
  padding:14px;
  display:flex;
  flex-direction:column;
  transition:transform .25s ease;
}

.sidebar h2{
  font-size:18px;
  margin:8px 0 12px;
}

.chat-list{
  flex:1;
  overflow:auto;
}

.chat-item{
  padding:12px;
  border-radius:14px;
  margin-bottom:8px;
  cursor:pointer;
  transition:.2s;
  display:flex;
  align-items:center;
  gap:8px;
}

.chat-item span{
  flex:1;
}

.chat-item.active,
.chat-item:hover{
  background:rgba(0,0,0,.05);
}

.chat-item button{
  background:none;
  border:none;
  cursor:pointer;
  font-size:14px;
  opacity:.6;
}

.new-chat{
  background:var(--accent);
  color:white;
  border:none;
  padding:20px;
  border-radius:64px;
  font-weight:600;
}

.new-chat i{font-size:22px}

/* Main */
.main{
  flex:1;
  display:flex;
  flex-direction:column;
}

.header{
  padding:16px;
  font-weight:600;
  font-size:17px;
  border-bottom:1px solid var(--border);
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:10px;
}

/* Hamburger invisible */
.hamburger{
  width:22px;
  height:14px;
  position:relative;
  opacity:.45;
  display:none;
}
.hamburger span{
  position:absolute;
  width:100%;
  height:2px;
  background:#000;
  border-radius:2px;
}
.hamburger span:nth-child(1){top:0}
.hamburger span:nth-child(2){top:6px}
.hamburger span:nth-child(3){top:12px}

.header-actions{
  margin-left:auto;
  display:flex;
  gap:10px;
}

.header-actions button{
  background:none;
  border:none;
  cursor:pointer;
  font-size:36px;
  opacity:.6;
}

.messages{
  flex:1;
  padding:16px;
  overflow:auto;
}

.message{
  background:var(--card);
  backdrop-filter:blur(var(--blur));
  border-radius:60px;
  padding:12px 14px;
  margin-bottom:10px;
  position:relative;
}

.message small{
  color:var(--muted);
  display:block;
  margin-top:4px;
}

.message .actions{
  position:absolute;
  right:10px;
  top:8px;
  display:flex;
  gap:6px;
}

.footer{
  padding:14px;
  display:flex;
  gap:10px;
  border-top:1px solid var(--border);
}

.footer input{
  flex:1;
  padding:14px;
  border-radius:16px;
  border:1px solid var(--border);
}

.footer button{
  padding:14px 18px;
  border-radius:60px;
  border:none;
  background:var(--accent);
  color:white;
}

.total{
  padding:14px 18px;
  background:rgba(0,0,0,.03);
  font-weight:600;
}

/* Mobile */
@media(max-width:720px){
  .sidebar{
    position:absolute;
    height:100%;
    left:0;
    top:0;
    transform:translateX(-100%);
    z-index:10;
  }
  .sidebar.show{
    transform:translateX(0);
  }
  .hamburger{
    display:block;
  }
}
</style>
</head>

<body>
<div class="app">

  <div class="sidebar" id="sidebar">
    <h2>Listas</h2>
    <div class="chat-list" id="chatList"></div>
    <button class="new-chat" onclick="createChat()"><i class="fi fi-sr-add-document"></i></button>
  </div>

  <div class="main" id="main">

    <div class="header" id="chatTitle">
      <div class="hamburger">
        <span></span><span></span><span></span>
      </div>
      <span id="titleText">Selecciona una lista</span>

      <div class="header-actions">
        <button onclick="downloadPDF()"><i class="fi fi-sr-file-pdf"></i></button>
      </div>
    </div>

    <div class="messages" id="messages"></div>
    <div class="total" id="total">Total: $0</div>

    <div class="footer">
      <input id="input" placeholder="Ej: Carro 35000">
      <button onclick="sendMessage()"><i class="fi fi-sr-paper-plane-top"></i></button>
    </div>
  </div>

</div>

<script>
let data = JSON.parse(localStorage.getItem("shoppingChat")) || { chats:{} }
let currentChat = null
const sidebar = document.getElementById("sidebar")
const main = document.getElementById("main")

function isMobile(){ return innerWidth <= 720 }

document.getElementById("chatTitle").onclick = () => {
  if(isMobile()) sidebar.classList.toggle("show")
}

function save(){
  localStorage.setItem("shoppingChat",JSON.stringify(data))
}

function createChat(){
  const name = prompt("Nombre de la lista")
  if(!name) return
  const id = Date.now().toString()
  data.chats[id] = { name, messages:[] }
  currentChat = id
  save()
  renderChats()
  renderChat()
}

function editChat(id){
  const name = prompt("Editar nombre", data.chats[id].name)
  if(!name) return
  data.chats[id].name = name
  save()
  renderChats()
  renderChat()
}

function deleteChat(id){
  if(!confirm("¬øEliminar esta lista?")) return
  delete data.chats[id]
  if(currentChat === id) currentChat = null
  save()
  renderChats()
  document.getElementById("messages").innerHTML=""
  document.getElementById("titleText").textContent="Selecciona una lista"
  document.getElementById("total").textContent="Total: $0"
}

function renderChats(){
  const list = document.getElementById("chatList")
  list.innerHTML=""
  Object.entries(data.chats).forEach(([id,chat])=>{
    const div=document.createElement("div")
    div.className="chat-item"+(id===currentChat?" active":"")
    div.innerHTML=`
      <span>${chat.name}</span>
      <button onclick="event.stopPropagation();editChat('${id}')">‚úèÔ∏è</button>
      <button onclick="event.stopPropagation();deleteChat('${id}')">üóëÔ∏è</button>
    `
    div.onclick=()=>{
      currentChat=id
      renderChats()
      renderChat()
      if(isMobile()) sidebar.classList.remove("show")
    }
    list.appendChild(div)
  })
}

function renderChat(){
  if(!currentChat) return
  document.getElementById("titleText").textContent=data.chats[currentChat].name
  const box=document.getElementById("messages")
  box.innerHTML=""
  let total=0

  data.chats[currentChat].messages.forEach(m=>{
    const div=document.createElement("div")
    div.className="message"
    div.innerHTML=`
      ${m.text}
      <small>${m.value?("$"+m.value.toLocaleString()):""}</small>
      <div class="actions">
        <button onclick="editMsg('${m.id}')">‚úèÔ∏è</button>
        <button onclick="delMsg('${m.id}')">üóëÔ∏è</button>
      </div>`
    box.appendChild(div)
    total+=m.value||0
  })

  document.getElementById("total").textContent="Total: $"+total.toLocaleString()
}

function sendMessage(){
  if(!currentChat) return
  const input=document.getElementById("input")
  const text=input.value.trim()
  if(!text) return

  const match=text.match(/(\d+(\.\d+)?)/)
  const value=match?Number(match[1]):0

  data.chats[currentChat].messages.push({
    id:Date.now().toString(),
    text,
    value
  })

  input.value=""
  save()
  renderChat()
}

function editMsg(id){
  const msg=data.chats[currentChat].messages.find(m=>m.id===id)
  const text=prompt("Editar",msg.text)
  if(!text) return
  const match=text.match(/(\d+(\.\d+)?)/)
  msg.text=text
  msg.value=match?Number(match[1]):0
  save()
  renderChat()
}

function delMsg(id){
  data.chats[currentChat].messages =
    data.chats[currentChat].messages.filter(m=>m.id!==id)
  save()
  renderChat()
}

function downloadPDF(){
  if(!currentChat) return

  const element = document.createElement("div")
  element.innerHTML = `
    <h2>${data.chats[currentChat].name}</h2>
    ${data.chats[currentChat].messages.map(m=>`
      <p>${m.text} ${m.value?("- $"+m.value.toLocaleString()):""}</p>
    `).join("")}
    <h3>${document.getElementById("total").textContent}</h3>
  `

  html2pdf().from(element).set({
    margin:10,
    filename:data.chats[currentChat].name+".pdf",
    html2canvas:{scale:2}
  }).save()
}

renderChats()
</script>

</body>
</html>
