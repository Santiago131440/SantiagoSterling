<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cuentas</title>
<link rel='stylesheet' href='https://cdn-uicons.flaticon.com/3.0.0/uicons-solid-rounded/css/uicons-solid-rounded.css'>


<style>
:root{
  --bg:#f5f5f7;
  --card:rgba(255,255,255,.85);
  --border:rgba(0,0,0,.08);
  --accent:#007aff;
  --text:#1c1c1e;
  --muted:#6e6e73;
  --radius:18px;
  --blur:22px;
}

*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text",sans-serif}

body{
  margin:0;
  background:linear-gradient(180deg,#fff,#eaeaee);
  color:var(--text);
  height:100vh;
  display:flex;
}

.app{
  display:flex;
  width:100%;
}

/* Sidebar */
.sidebar{
  width:280px;
  background:var(--card);
  backdrop-filter:blur(var(--blur));
  border-right:1px solid var(--border);
  padding:14px;
  display:flex;
  flex-direction:column;
}

.sidebar h2{
  font-size:18px;
  margin:8px 0 12px;
}

.chat-list{
  flex:1;
  overflow:auto;
}

.chat-item{
  padding:12px;
  border-radius:14px;
  margin-bottom:8px;
  cursor:pointer;
  transition:.2s;
  background:transparent;
}

.chat-item.active,
.chat-item:hover{
  background:rgba(0,0,0,.05);
}

.new-chat{
  background:var(--accent);
  color:white;
  border:none;
  padding:20px;
  border-radius:64px;
  font-weight:600;
}

/* Main */
.main{
  flex:1;
  display:flex;
  flex-direction:column;
}

.header{
  padding:16px;
  font-weight:600;
  font-size:17px;
  border-bottom:1px solid var(--border);
}

.messages{
  flex:1;
  padding:16px;
  overflow:auto;
}

.message{
  background:var(--card);
  backdrop-filter:blur(var(--blur));
  border-radius:60px;
  padding:12px 14px;
  margin-bottom:10px;
  position:relative;
}

.message small{
  color:var(--muted);
  display:block;
  margin-top:4px;
}

.message .actions{
  position:absolute;
  right:10px;
  top:8px;
  display:flex;
  gap:6px;
}

.message button{
  background:none;
  border:none;
  cursor:pointer;
  font-size:14px;
}

.footer{
  padding:14px;
  display:flex;
  gap:10px;
  border-top:1px solid var(--border);
}

.footer input{
  flex:1;
  padding:14px;
  border-radius:16px;
  border:1px solid var(--border);
  font-size:15px;
}

.new-chat i {
  font-size: 22px;;
}

.footer button{
  padding:14px 18px;
  border-radius:60px;
  border:none;
  background:var(--accent);
  color:white;
  font-weight:600;
}

/* Total */
.total{
  padding:14px 18px;
  background:rgba(0,0,0,.03);
  font-weight:600;
}

/* Mobile */
@media(max-width:720px){
  .sidebar{width:100px}
  .chat-item{font-size:12px}
}
</style>
</head>

<body>
<div class="app">

  <div class="sidebar">
    <h2>Listas</h2>
    <div class="chat-list" id="chatList"></div>
    <button class="new-chat" onclick="createChat()"><i class="fi fi-sr-add-document"></i></button>
  </div>

  <div class="main">
    <div class="header" id="chatTitle">Selecciona una lista</div>
    <div class="messages" id="messages"></div>
    <div class="total" id="total">Total: $0</div>

    <div class="footer">
      <input id="input" placeholder="Ej: Carro 35000">
      <button onclick="sendMessage()"><i class="fi fi-sr-paper-plane-top"></i></button>
    </div>
  </div>

</div>

<script>
let data = JSON.parse(localStorage.getItem("shoppingChat")) || { chats:{} }
let currentChat = null

function save(){
  localStorage.setItem("shoppingChat",JSON.stringify(data))
}

function createChat(){
  const name = prompt("Nombre de la lista")
  if(!name) return
  const id = Date.now().toString()
  data.chats[id] = { name, messages:[] }
  currentChat = id
  save()
  renderChats()
  renderChat()
}

function renderChats(){
  const list = document.getElementById("chatList")
  list.innerHTML=""
  Object.entries(data.chats).forEach(([id,chat])=>{
    const div=document.createElement("div")
    div.className="chat-item"+(id===currentChat?" active":"")
    div.textContent=chat.name
    div.onclick=()=>{currentChat=id;renderChats();renderChat()}
    list.appendChild(div)
  })
}

function renderChat(){
  if(!currentChat) return
  document.getElementById("chatTitle").textContent=data.chats[currentChat].name
  const box=document.getElementById("messages")
  box.innerHTML=""
  let total=0

  data.chats[currentChat].messages.forEach(m=>{
    const div=document.createElement("div")
    div.className="message"
    div.innerHTML=`
      ${m.text}
      <small>${m.value?("$"+m.value.toLocaleString()):""}</small>
      <div class="actions">
        <button onclick="editMsg('${m.id}')">‚úèÔ∏è</button>
        <button onclick="delMsg('${m.id}')">üóëÔ∏è</button>
      </div>`
    box.appendChild(div)
    total+=m.value||0
  })

  document.getElementById("total").textContent="Total: $"+total.toLocaleString()
}

function sendMessage(){
  if(!currentChat) return
  const input=document.getElementById("input")
  const text=input.value.trim()
  if(!text) return

  const match=text.match(/(\d+(\.\d+)?)/)
  const value=match?Number(match[1]):0

  data.chats[currentChat].messages.push({
    id:Date.now().toString(),
    text,
    value
  })

  input.value=""
  save()
  renderChat()
}

function editMsg(id){
  const msg=data.chats[currentChat].messages.find(m=>m.id===id)
  const text=prompt("Editar",msg.text)
  if(!text) return
  const match=text.match(/(\d+(\.\d+)?)/)
  msg.text=text
  msg.value=match?Number(match[1]):0
  save()
  renderChat()
}

function delMsg(id){
  data.chats[currentChat].messages=
    data.chats[currentChat].messages.filter(m=>m.id!==id)
  save()
  renderChat()
}

renderChats()
</script>

</body>
</html>
